/*!
 * otherlevels - v1.16.0
 * 2018-11-13
 * HEAD / d18d64fa970b46952e6531f06473b87cbf3d821f
 */


!function o(s,a,u){function c(t,e){if(!a[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(l)return l(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[t]={exports:{}};s[t][0].call(i.exports,function(e){return c(s[t][1][e]||e)},i,i.exports,o,s,a,u)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<u.length;e++)c(u[e]);return c}({1:[function(e,t,n){var r,i;r=this,i=function(){"use strict";return function(){var d=Math.floor(1000001*Math.random()),p={};function E(e){return Array.isArray?Array.isArray(e):-1!=e.constructor.toString().indexOf("Array")}var T={},e=function(e){try{var t=JSON.parse(e.data);if("object"!=typeof t||null===t)throw"malformed"}catch(e){return}var n,r,i,o=e.source,s=e.origin;if("string"==typeof t.method){var a=t.method.split("::");i=2==a.length?(n=a[0],a[1]):t.method}if(void 0!==t.id&&(r=t.id),"string"==typeof i){var u=!1;if(p[s]&&p[s][n])for(var c=0;c<p[s][n].length;c++)if(p[s][n][c].win===o){p[s][n][c].handler(s,i,t),u=!0;break}if(!u&&p["*"]&&p["*"][n])for(c=0;c<p["*"][n].length;c++)if(p["*"][n][c].win===o){p["*"][n][c].handler(s,i,t);break}}else void 0!==r&&T[r]&&T[r](s,i,t)};return window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent&&window.attachEvent("onmessage",e),{build:function(b){var y=function(e){if(b.debugOutput&&window.console&&window.console.log){try{"string"!=typeof e&&(e=JSON.stringify(e))}catch(e){}window.console.log("["+r+"] "+e)}};if(!window.postMessage)throw"jschannel cannot run this browser, no postMessage";if(!window.JSON||!window.JSON.stringify||!window.JSON.parse)throw"jschannel cannot run this browser, no JSON parsing/serialization";if("object"!=typeof b)throw"Channel build invoked without a proper object argument";if(!b.window||!b.window.postMessage)throw"Channel.build() called without a valid window argument";window===b.window&&y("target window is same as present window -- use at your own risk");var e,t=!1;"string"==typeof b.origin&&("*"===b.origin?t=!0:null!==(e=b.origin.match(/^https?:\/\/(?:[-a-zA-Z0-9_\.])+(?::\d+)?/))&&(b.origin=e[0].toLowerCase(),t=!0));if(!t)throw"Channel.build() called with an invalid origin";if(void 0!==b.scope){if("string"!=typeof b.scope)throw"scope, when specified, must be a string";if(1<b.scope.split("::").length)throw"scope may not contain double colons: '::'"}else b.scope="__default";var r=function(){for(var e="",t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n=0;n<5;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}(),_={},w={},S={},i=!1,o=[],s=[],c=function(e,t,n){if("function"==typeof b.gotMessageObserver)try{b.gotMessageObserver(e,n)}catch(e){y("gotMessageObserver() raised an exception: "+e.toString())}if(n.id&&t){S[n.id]={};var r=(f=n.id,g=e,h=n.callbacks?n.callbacks:[],v=m=!1,{origin:g,invoke:function(e,t){if(!S[f])throw"attempting to invoke a callback of a nonexistent transaction: "+f;for(var n=!1,r=0;r<h.length;r++)if(e===h[r]){n=!0;break}if(!n)throw"request supports no such callback '"+e+"'";k({id:f,callback:e,params:t})},error:function(e,t){if(v=!0,!S[f])throw"error called for nonexistent message: "+f;delete S[f],k({id:f,error:e,message:t})},complete:function(e){if(v=!0,!S[f])throw"complete called for nonexistent message: "+f;delete S[f],k({id:f,result:e})},delayReturn:function(e){return"boolean"==typeof e&&(m=!0===e),m},completed:function(){return v}});if(_[t])try{if(n.callbacks&&E(n.callbacks)&&0<n.callbacks.length)for(var i=0;i<n.callbacks.length;i++){for(var o=n.callbacks[i],s=n.params,a=o.split("/"),u=0;u<a.length-1;u++){var c=a[u];"object"!=typeof s[c]&&(s[c]={}),s=s[c]}s[a[a.length-1]]=function(){var t=o;return function(e){return r.invoke(t,e)}}()}var l=_[t](r,n.params);r.delayReturn()||r.completed()||r.complete(l)}catch(t){var d="runtime_error",p=null;if("string"==typeof t?p=t:"object"==typeof t&&(t instanceof Error?(d=t.constructor.name,p=t.message):t&&E(t)&&2==t.length?(d=t[0],p=t[1]):"string"==typeof t.error&&(d=t.error,t.message?"string"==typeof t.message?p=t.message:t=t.message:p="")),null===p)try{void 0===(p=JSON.stringify(t))&&(p=t.toString())}catch(e){p=t.toString()}r.error(d,p)}else r.error("method_not_found","No method '"+t+"' was (yet) bound by the provider")}else n.id&&n.callback?w[n.id]&&w[n.id].callbacks&&w[n.id].callbacks[n.callback]?w[n.id].callbacks[n.callback](n.params):y("ignoring invalid callback, id:"+n.id+" ("+n.callback+")"):n.id?w[n.id]?(n.error?w[n.id].error&&w[n.id].error(n.error,n.message):void 0!==n.result?w[n.id].success(n.result):w[n.id].success(),delete w[n.id],delete T[n.id]):y("ignoring invalid response: "+n.id):t&&_[t]&&_[t]({origin:e},n.params);var f,g,h,m,v};!function(n,e,t,r){function i(e){for(var t=0;t<e.length;t++)if(e[t].win===n)return!0;return!1}var o=!1;if("*"===e){for(var s in p)if(p.hasOwnProperty(s)&&"*"!==s&&"object"==typeof p[s][t]&&(o=i(p[s][t])))break}else p["*"]&&p["*"][t]&&(o=i(p["*"][t])),!o&&p[e]&&p[e][t]&&(o=i(p[e][t]));if(o)throw"A channel is already bound to the same window which overlaps with origin '"+e+"' and has scope '"+t+"'";"object"!=typeof p[e]&&(p[e]={}),"object"!=typeof p[e][t]&&(p[e][t]=[]),p[e][t].push({win:n,handler:r})}(b.window,b.origin,b.scope,c);var l=function(e){return[b.scope,e].join("::")},k=function(e,t){if(!e)throw"postMessage called with null message";if(t||i){if("function"==typeof b.postMessageObserver)try{b.postMessageObserver(b.origin,e)}catch(e){y("postMessageObserver() raised an exception: "+e.toString())}y("post message: "+JSON.stringify(e)+" with origin "+b.origin),b.window.postMessage(JSON.stringify(e),b.origin)}else y("queue message: "+JSON.stringify(e)),o.push(e)},a=function(e,t){var n;e=[].concat(e);for(var r=0;r<e.length;r++)t[n=e[r].toString()]=function(r){return function(e,t,n){t?u.call({method:r,params:e,success:t,error:n}):u.notify({method:r,params:e})}}(n)},u={remote:{},unbind:function(e,t){if(_[e]){if(!delete _[e])throw"can't delete method: "+e;return b.publish&&!t&&(i?u.notify({method:"__unbind",params:e}):s.push({action:"unbind",method:e})),!0}return!1},bind:function(e,t,n){if(!e||"string"!=typeof e)throw"'method' argument to bind must be string";if(!t||"function"!=typeof t)throw"callback missing from bind params";if(_[e])throw"method '"+e+"' is already bound!";return _[e]=t,b.publish&&!n&&(i?u.notify({method:"__bind",params:e}):s.push({action:"bind",method:e})),this},call:function(e){if(!e)throw"missing arguments to call function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to call must be string";if(!e.success||"function"!=typeof e.success)throw"'success' callback missing from call";var i={},o=[],s=[],a=function(e,t){if(0<=s.indexOf(t))throw"params cannot be a recursive data structure";if(t&&s.push(t),"object"==typeof t)for(var n in t)if(t.hasOwnProperty(n)){var r=e+(e.length?"/":"")+n;"function"==typeof t[n]?(i[r]=t[n],o.push(r),delete t[n]):"object"==typeof t[n]&&a(r,t[n])}};a("",e.params);var t,n,r,u={id:d,method:l(e.method),params:e.params};o.length&&(u.callbacks=o),e.timeout&&(t=d,n=e.timeout,r=l(e.method),window.setTimeout(function(){if(w[t]){var e="timeout ("+n+"ms) exceeded on method '"+r+"'";w[t].error&&w[t].error("timeout_error",e),delete w[t],delete T[t]}},n)),w[d]={callbacks:i,error:e.error,success:e.success},T[d]=c,d++,k(u)},notify:function(e){if(!e)throw"missing arguments to notify function";if(!e.method||"string"!=typeof e.method)throw"'method' argument to notify must be string";k({method:l(e.method),params:e.params})},destroy:function(){!function(e,t,n){for(var r=p[t][n],i=0;i<r.length;i++)r[i].win===e&&r.splice(i,1);0===p[t][n].length&&delete p[t][n]}(b.window,b.origin,b.scope),window.removeEventListener?window.removeEventListener("message",c,!1):window.detachEvent&&window.detachEvent("onmessage",c),i=!1,_={},S={},w={},b.origin=null,o=[],y("channel destroyed"),r=""}};return u.bind("__ready",function(e,t){if(y("ready msg received"),i&&!b.reconnect)throw"received ready message while in ready state.";i=!0,r.length<6&&("publish-request"===t.type?r+="-R":r+="-L"),y("ready msg accepted."),"publish-request"===t.type&&u.notify({method:"__ready",params:{type:"publish-reply",publish:s}});for(var n=0;n<t.publish.length;n++)"bind"===t.publish[n].action?a([t.publish[n].method],u.remote):delete u.remote[t.publish[n].method];for(b.reconnect||u.unbind("__ready",!0);o.length;)k(o.splice(0,1)[0]);s=[],"function"==typeof b.onReady&&b.onReady(u)},!0),u.bind("__bind",function(e,t){a([t],u.remote)},!0),u.bind("__unbind",function(e,t){u.remote[t]&&delete u.remote[t]},!0),b.remote&&a(b.remote,u.remote),setTimeout(function(){0<r.length&&k({method:l("__ready"),params:{type:"publish-request",publish:s}},!0)},0),u}}}()},"object"==typeof n?t.exports=i():"function"==typeof define&&define.amd?define([],function(){return r.Channel=i()}):r.Channel=i()},{}],2:[function(e,Y,$){(function(Q){!function(){var e="object"==typeof self&&self.self===self&&self||"object"==typeof Q&&Q.global===Q&&Q||this||{},t=e._,r=Array.prototype,s=Object.prototype,d="undefined"!=typeof Symbol?Symbol.prototype:null,i=r.push,u=r.slice,p=s.toString,o=s.hasOwnProperty,n=Array.isArray,a=Object.keys,c=Object.create,l=function(){},f=function(e){return e instanceof f?e:this instanceof f?void(this._wrapped=e):new f(e)};void 0===$||$.nodeType?e._=f:(void 0!==Y&&!Y.nodeType&&Y.exports&&($=Y.exports=f),$._=f),f.VERSION="1.9.1";var g,h=function(i,o,e){if(void 0===o)return i;switch(null==e?3:e){case 1:return function(e){return i.call(o,e)};case 3:return function(e,t,n){return i.call(o,e,t,n)};case 4:return function(e,t,n,r){return i.call(o,e,t,n,r)}}return function(){return i.apply(o,arguments)}},m=function(e,t,n){return f.iteratee!==g?f.iteratee(e,t):null==e?f.identity:f.isFunction(e)?h(e,t,n):f.isObject(e)&&!f.isArray(e)?f.matcher(e):f.property(e)};f.iteratee=g=function(e,t){return m(e,t,1/0)};var v=function(i,o){return o=null==o?i.length-1:+o,function(){for(var e=Math.max(arguments.length-o,0),t=Array(e),n=0;n<e;n++)t[n]=arguments[n+o];switch(o){case 0:return i.call(this,t);case 1:return i.call(this,arguments[0],t);case 2:return i.call(this,arguments[0],arguments[1],t)}var r=Array(o+1);for(n=0;n<o;n++)r[n]=arguments[n];return r[o]=t,i.apply(this,r)}},b=function(e){if(!f.isObject(e))return{};if(c)return c(e);l.prototype=e;var t=new l;return l.prototype=null,t},y=function(t){return function(e){return null==e?void 0:e[t]}},_=function(e,t){return null!=e&&o.call(e,t)},w=function(e,t){for(var n=t.length,r=0;r<n;r++){if(null==e)return;e=e[t[r]]}return n?e:void 0},S=Math.pow(2,53)-1,k=y("length"),E=function(e){var t=k(e);return"number"==typeof t&&0<=t&&t<=S};f.each=f.forEach=function(e,t,n){var r,i;if(t=h(t,n),E(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var o=f.keys(e);for(r=0,i=o.length;r<i;r++)t(e[o[r]],o[r],e)}return e},f.map=f.collect=function(e,t,n){t=m(t,n);for(var r=!E(e)&&f.keys(e),i=(r||e).length,o=Array(i),s=0;s<i;s++){var a=r?r[s]:s;o[s]=t(e[a],a,e)}return o};var T=function(u){return function(e,t,n,r){var i=3<=arguments.length;return function(e,t,n,r){var i=!E(e)&&f.keys(e),o=(i||e).length,s=0<u?0:o-1;for(r||(n=e[i?i[s]:s],s+=u);0<=s&&s<o;s+=u){var a=i?i[s]:s;n=t(n,e[a],a,e)}return n}(e,h(t,r,4),n,i)}};f.reduce=f.foldl=f.inject=T(1),f.reduceRight=f.foldr=T(-1),f.find=f.detect=function(e,t,n){var r=(E(e)?f.findIndex:f.findKey)(e,t,n);if(void 0!==r&&-1!==r)return e[r]},f.filter=f.select=function(e,r,t){var i=[];return r=m(r,t),f.each(e,function(e,t,n){r(e,t,n)&&i.push(e)}),i},f.reject=function(e,t,n){return f.filter(e,f.negate(m(t)),n)},f.every=f.all=function(e,t,n){t=m(t,n);for(var r=!E(e)&&f.keys(e),i=(r||e).length,o=0;o<i;o++){var s=r?r[o]:o;if(!t(e[s],s,e))return!1}return!0},f.some=f.any=function(e,t,n){t=m(t,n);for(var r=!E(e)&&f.keys(e),i=(r||e).length,o=0;o<i;o++){var s=r?r[o]:o;if(t(e[s],s,e))return!0}return!1},f.contains=f.includes=f.include=function(e,t,n,r){return E(e)||(e=f.values(e)),("number"!=typeof n||r)&&(n=0),0<=f.indexOf(e,t,n)},f.invoke=v(function(e,n,r){var i,o;return f.isFunction(n)?o=n:f.isArray(n)&&(i=n.slice(0,-1),n=n[n.length-1]),f.map(e,function(e){var t=o;if(!t){if(i&&i.length&&(e=w(e,i)),null==e)return;t=e[n]}return null==t?t:t.apply(e,r)})}),f.pluck=function(e,t){return f.map(e,f.property(t))},f.where=function(e,t){return f.filter(e,f.matcher(t))},f.findWhere=function(e,t){return f.find(e,f.matcher(t))},f.max=function(e,r,t){var n,i,o=-1/0,s=-1/0;if(null==r||"number"==typeof r&&"object"!=typeof e[0]&&null!=e)for(var a=0,u=(e=E(e)?e:f.values(e)).length;a<u;a++)null!=(n=e[a])&&o<n&&(o=n);else r=m(r,t),f.each(e,function(e,t,n){i=r(e,t,n),(s<i||i===-1/0&&o===-1/0)&&(o=e,s=i)});return o},f.min=function(e,r,t){var n,i,o=1/0,s=1/0;if(null==r||"number"==typeof r&&"object"!=typeof e[0]&&null!=e)for(var a=0,u=(e=E(e)?e:f.values(e)).length;a<u;a++)null!=(n=e[a])&&n<o&&(o=n);else r=m(r,t),f.each(e,function(e,t,n){((i=r(e,t,n))<s||i===1/0&&o===1/0)&&(o=e,s=i)});return o},f.shuffle=function(e){return f.sample(e,1/0)},f.sample=function(e,t,n){if(null==t||n)return E(e)||(e=f.values(e)),e[f.random(e.length-1)];var r=E(e)?f.clone(e):f.values(e),i=k(r);t=Math.max(Math.min(t,i),0);for(var o=i-1,s=0;s<t;s++){var a=f.random(s,o),u=r[s];r[s]=r[a],r[a]=u}return r.slice(0,t)},f.sortBy=function(e,r,t){var i=0;return r=m(r,t),f.pluck(f.map(e,function(e,t,n){return{value:e,index:i++,criteria:r(e,t,n)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(r<n||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index}),"value")};var I=function(s,t){return function(r,i,e){var o=t?[[],[]]:{};return i=m(i,e),f.each(r,function(e,t){var n=i(e,t,r);s(o,e,n)}),o}};f.groupBy=I(function(e,t,n){_(e,n)?e[n].push(t):e[n]=[t]}),f.indexBy=I(function(e,t,n){e[n]=t}),f.countBy=I(function(e,t,n){_(e,n)?e[n]++:e[n]=1});var x=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;f.toArray=function(e){return e?f.isArray(e)?u.call(e):f.isString(e)?e.match(x):E(e)?f.map(e,f.identity):f.values(e):[]},f.size=function(e){return null==e?0:E(e)?e.length:f.keys(e).length},f.partition=I(function(e,t,n){e[n?0:1].push(t)},!0),f.first=f.head=f.take=function(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[0]:f.initial(e,e.length-t)},f.initial=function(e,t,n){return u.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},f.last=function(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[e.length-1]:f.rest(e,Math.max(0,e.length-t))},f.rest=f.tail=f.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},f.compact=function(e){return f.filter(e,Boolean)};var C=function(e,t,n,r){for(var i=(r=r||[]).length,o=0,s=k(e);o<s;o++){var a=e[o];if(E(a)&&(f.isArray(a)||f.isArguments(a)))if(t)for(var u=0,c=a.length;u<c;)r[i++]=a[u++];else C(a,t,n,r),i=r.length;else n||(r[i++]=a)}return r};f.flatten=function(e,t){return C(e,t,!1)},f.without=v(function(e,t){return f.difference(e,t)}),f.uniq=f.unique=function(e,t,n,r){f.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=m(n,r));for(var i=[],o=[],s=0,a=k(e);s<a;s++){var u=e[s],c=n?n(u,s,e):u;t&&!n?(s&&o===c||i.push(u),o=c):n?f.contains(o,c)||(o.push(c),i.push(u)):f.contains(i,u)||i.push(u)}return i},f.union=v(function(e){return f.uniq(C(e,!0,!0))}),f.intersection=function(e){for(var t=[],n=arguments.length,r=0,i=k(e);r<i;r++){var o=e[r];if(!f.contains(t,o)){var s;for(s=1;s<n&&f.contains(arguments[s],o);s++);s===n&&t.push(o)}}return t},f.difference=v(function(e,t){return t=C(t,!0,!0),f.filter(e,function(e){return!f.contains(t,e)})}),f.unzip=function(e){for(var t=e&&f.max(e,k).length||0,n=Array(t),r=0;r<t;r++)n[r]=f.pluck(e,r);return n},f.zip=v(f.unzip),f.object=function(e,t){for(var n={},r=0,i=k(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n};var P=function(o){return function(e,t,n){t=m(t,n);for(var r=k(e),i=0<o?0:r-1;0<=i&&i<r;i+=o)if(t(e[i],i,e))return i;return-1}};f.findIndex=P(1),f.findLastIndex=P(-1),f.sortedIndex=function(e,t,n,r){for(var i=(n=m(n,r,1))(t),o=0,s=k(e);o<s;){var a=Math.floor((o+s)/2);n(e[a])<i?o=a+1:s=a}return o};var O=function(o,s,a){return function(e,t,n){var r=0,i=k(e);if("number"==typeof n)0<o?r=0<=n?n:Math.max(n+i,r):i=0<=n?Math.min(n+1,i):n+i+1;else if(a&&n&&i)return e[n=a(e,t)]===t?n:-1;if(t!=t)return 0<=(n=s(u.call(e,r,i),f.isNaN))?n+r:-1;for(n=0<o?r:i-1;0<=n&&n<i;n+=o)if(e[n]===t)return n;return-1}};f.indexOf=O(1,f.findIndex,f.sortedIndex),f.lastIndexOf=O(-1,f.findLastIndex),f.range=function(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),o=0;o<r;o++,e+=n)i[o]=e;return i},f.chunk=function(e,t){if(null==t||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(u.call(e,r,r+=t));return n};var L=function(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var o=b(e.prototype),s=e.apply(o,i);return f.isObject(s)?s:o};f.bind=v(function(t,n,r){if(!f.isFunction(t))throw new TypeError("Bind must be called on a function");var i=v(function(e){return L(t,i,n,this,r.concat(e))});return i}),f.partial=v(function(i,o){var s=f.partial.placeholder,a=function(){for(var e=0,t=o.length,n=Array(t),r=0;r<t;r++)n[r]=o[r]===s?arguments[e++]:o[r];for(;e<arguments.length;)n.push(arguments[e++]);return L(i,a,this,this,n)};return a}),(f.partial.placeholder=f).bindAll=v(function(e,t){var n=(t=C(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=f.bind(e[r],e)}}),f.memoize=function(r,i){var o=function(e){var t=o.cache,n=""+(i?i.apply(this,arguments):e);return _(t,n)||(t[n]=r.apply(this,arguments)),t[n]};return o.cache={},o},f.delay=v(function(e,t,n){return setTimeout(function(){return e.apply(null,n)},t)}),f.defer=f.partial(f.delay,f,1),f.throttle=function(n,r,i){var o,s,a,u,c=0;i||(i={});var l=function(){c=!1===i.leading?0:f.now(),o=null,u=n.apply(s,a),o||(s=a=null)},e=function(){var e=f.now();c||!1!==i.leading||(c=e);var t=r-(e-c);return s=this,a=arguments,t<=0||r<t?(o&&(clearTimeout(o),o=null),c=e,u=n.apply(s,a),o||(s=a=null)):o||!1===i.trailing||(o=setTimeout(l,t)),u};return e.cancel=function(){clearTimeout(o),c=0,o=s=a=null},e},f.debounce=function(n,r,i){var o,s,a=function(e,t){o=null,t&&(s=n.apply(e,t))},e=v(function(e){if(o&&clearTimeout(o),i){var t=!o;o=setTimeout(a,r),t&&(s=n.apply(this,e))}else o=f.delay(a,r,this,e);return s});return e.cancel=function(){clearTimeout(o),o=null},e},f.wrap=function(e,t){return f.partial(t,e)},f.negate=function(e){return function(){return!e.apply(this,arguments)}},f.compose=function(){var n=arguments,r=n.length-1;return function(){for(var e=r,t=n[r].apply(this,arguments);e--;)t=n[e].call(this,t);return t}},f.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},f.before=function(e,t){var n;return function(){return 0<--e&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},f.once=f.partial(f.before,2),f.restArguments=v;var D=!{toString:null}.propertyIsEnumerable("toString"),N=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],R=function(e,t){var n=N.length,r=e.constructor,i=f.isFunction(r)&&r.prototype||s,o="constructor";for(_(e,o)&&!f.contains(t,o)&&t.push(o);n--;)(o=N[n])in e&&e[o]!==i[o]&&!f.contains(t,o)&&t.push(o)};f.keys=function(e){if(!f.isObject(e))return[];if(a)return a(e);var t=[];for(var n in e)_(e,n)&&t.push(n);return D&&R(e,t),t},f.allKeys=function(e){if(!f.isObject(e))return[];var t=[];for(var n in e)t.push(n);return D&&R(e,t),t},f.values=function(e){for(var t=f.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r},f.mapObject=function(e,t,n){t=m(t,n);for(var r=f.keys(e),i=r.length,o={},s=0;s<i;s++){var a=r[s];o[a]=t(e[a],a,e)}return o},f.pairs=function(e){for(var t=f.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},f.invert=function(e){for(var t={},n=f.keys(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},f.functions=f.methods=function(e){var t=[];for(var n in e)f.isFunction(e[n])&&t.push(n);return t.sort()};var M=function(u,c){return function(e){var t=arguments.length;if(c&&(e=Object(e)),t<2||null==e)return e;for(var n=1;n<t;n++)for(var r=arguments[n],i=u(r),o=i.length,s=0;s<o;s++){var a=i[s];c&&void 0!==e[a]||(e[a]=r[a])}return e}};f.extend=M(f.allKeys),f.extendOwn=f.assign=M(f.keys),f.findKey=function(e,t,n){t=m(t,n);for(var r,i=f.keys(e),o=0,s=i.length;o<s;o++)if(t(e[r=i[o]],r,e))return r};var j,U,A=function(e,t,n){return t in n};f.pick=v(function(e,t){var n={},r=t[0];if(null==e)return n;f.isFunction(r)?(1<t.length&&(r=h(r,t[1])),t=f.allKeys(e)):(r=A,t=C(t,!1,!1),e=Object(e));for(var i=0,o=t.length;i<o;i++){var s=t[i],a=e[s];r(a,s,e)&&(n[s]=a)}return n}),f.omit=v(function(e,n){var t,r=n[0];return f.isFunction(r)?(r=f.negate(r),1<n.length&&(t=n[1])):(n=f.map(C(n,!1,!1),String),r=function(e,t){return!f.contains(n,t)}),f.pick(e,r,t)}),f.defaults=M(f.allKeys,!0),f.create=function(e,t){var n=b(e);return t&&f.extendOwn(n,t),n},f.clone=function(e){return f.isObject(e)?f.isArray(e)?e.slice():f.extend({},e):e},f.tap=function(e,t){return t(e),e},f.isMatch=function(e,t){var n=f.keys(t),r=n.length;if(null==e)return!r;for(var i=Object(e),o=0;o<r;o++){var s=n[o];if(t[s]!==i[s]||!(s in i))return!1}return!0},j=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var i=typeof e;return("function"===i||"object"===i||"object"==typeof t)&&U(e,t,n,r)},U=function(e,t,n,r){e instanceof f&&(e=e._wrapped),t instanceof f&&(t=t._wrapped);var i=p.call(e);if(i!==p.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return d.valueOf.call(e)===d.valueOf.call(t)}var o="[object Array]"===i;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(f.isFunction(s)&&s instanceof s&&f.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var u=(n=n||[]).length;u--;)if(n[u]===e)return r[u]===t;if(n.push(e),r.push(t),o){if((u=e.length)!==t.length)return!1;for(;u--;)if(!j(e[u],t[u],n,r))return!1}else{var c,l=f.keys(e);if(u=l.length,f.keys(t).length!==u)return!1;for(;u--;)if(c=l[u],!_(t,c)||!j(e[c],t[c],n,r))return!1}return n.pop(),r.pop(),!0},f.isEqual=function(e,t){return j(e,t)},f.isEmpty=function(e){return null==e||(E(e)&&(f.isArray(e)||f.isString(e)||f.isArguments(e))?0===e.length:0===f.keys(e).length)},f.isElement=function(e){return!(!e||1!==e.nodeType)},f.isArray=n||function(e){return"[object Array]"===p.call(e)},f.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},f.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(t){f["is"+t]=function(e){return p.call(e)==="[object "+t+"]"}}),f.isArguments(arguments)||(f.isArguments=function(e){return _(e,"callee")});var B=e.document&&e.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof B&&(f.isFunction=function(e){return"function"==typeof e||!1}),f.isFinite=function(e){return!f.isSymbol(e)&&isFinite(e)&&!isNaN(parseFloat(e))},f.isNaN=function(e){return f.isNumber(e)&&isNaN(e)},f.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"===p.call(e)},f.isNull=function(e){return null===e},f.isUndefined=function(e){return void 0===e},f.has=function(e,t){if(!f.isArray(t))return _(e,t);for(var n=t.length,r=0;r<n;r++){var i=t[r];if(null==e||!o.call(e,i))return!1;e=e[i]}return!!n},f.noConflict=function(){return e._=t,this},f.identity=function(e){return e},f.constant=function(e){return function(){return e}},f.noop=function(){},f.property=function(t){return f.isArray(t)?function(e){return w(e,t)}:y(t)},f.propertyOf=function(t){return null==t?function(){}:function(e){return f.isArray(e)?w(t,e):t[e]}},f.matcher=f.matches=function(t){return t=f.extendOwn({},t),function(e){return f.isMatch(e,t)}},f.times=function(e,t,n){var r=Array(Math.max(0,e));t=h(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},f.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},f.now=Date.now||function(){return(new Date).getTime()};var F={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},W=f.invert(F),V=function(t){var n=function(e){return t[e]},e="(?:"+f.keys(t).join("|")+")",r=RegExp(e),i=RegExp(e,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,n):e}};f.escape=V(F),f.unescape=V(W),f.result=function(e,t,n){f.isArray(t)||(t=[t]);var r=t.length;if(!r)return f.isFunction(n)?n.call(e):n;for(var i=0;i<r;i++){var o=null==e?void 0:e[t[i]];void 0===o&&(o=n,i=r),e=f.isFunction(o)?o.call(e):o}return e};var H=0;f.uniqueId=function(e){var t=++H+"";return e?e+t:t},f.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},G=/\\|'|\r|\n|\u2028|\u2029/g,z=function(e){return"\\"+J[e]};f.template=function(o,e,t){!e&&t&&(e=t),e=f.defaults({},e,f.templateSettings);var n,r=RegExp([(e.escape||q).source,(e.interpolate||q).source,(e.evaluate||q).source].join("|")+"|$","g"),s=0,a="__p+='";o.replace(r,function(e,t,n,r,i){return a+=o.slice(s,i).replace(G,z),s=i+e.length,t?a+="'+\n((__t=("+t+"))==null?'':_.escape(__t))+\n'":n?a+="'+\n((__t=("+n+"))==null?'':__t)+\n'":r&&(a+="';\n"+r+"\n__p+='"),e}),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{n=new Function(e.variable||"obj","_",a)}catch(e){throw e.source=a,e}var i=function(e){return n.call(this,e,f)},u=e.variable||"obj";return i.source="function("+u+"){\n"+a+"}",i},f.chain=function(e){var t=f(e);return t._chain=!0,t};var K=function(e,t){return e._chain?f(t).chain():t};f.mixin=function(n){return f.each(f.functions(n),function(e){var t=f[e]=n[e];f.prototype[e]=function(){var e=[this._wrapped];return i.apply(e,arguments),K(this,t.apply(f,e))}}),f},f.mixin(f),f.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var n=r[t];f.prototype[t]=function(){var e=this._wrapped;return n.apply(e,arguments),"shift"!==t&&"splice"!==t||0!==e.length||delete e[0],K(this,e)}}),f.each(["concat","join","slice"],function(e){var t=r[e];f.prototype[e]=function(){return K(this,t.apply(this._wrapped,arguments))}}),f.prototype.value=function(){return this._wrapped},f.prototype.valueOf=f.prototype.toJSON=f.prototype.value,f.prototype.toString=function(){return String(this._wrapped)},"function"==typeof define&&define.amd&&define("underscore",[],function(){return f})}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(e,t,n){var r=e("./v1"),i=e("./v4"),o=i;o.v1=r,o.v4=i,t.exports=o},{"./v1":6,"./v4":7}],4:[function(e,t,n){for(var i=[],r=0;r<256;++r)i[r]=(r+256).toString(16).substr(1);t.exports=function(e,t){var n=t||0,r=i;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}},{}],5:[function(e,t,n){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var i=new Uint8Array(16);t.exports=function(){return r(i),i}}else{var o=new Array(16);t.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},{}],6:[function(e,t,n){var g,h,m=e("./lib/rng"),v=e("./lib/bytesToUuid"),b=0,y=0;t.exports=function(e,t,n){var r=t&&n||0,i=t||[],o=(e=e||{}).node||g,s=void 0!==e.clockseq?e.clockseq:h;if(null==o||null==s){var a=m();null==o&&(o=g=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==s&&(s=h=16383&(a[6]<<8|a[7]))}var u=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:y+1,l=u-b+(c-y)/1e4;if(l<0&&void 0===e.clockseq&&(s=s+1&16383),(l<0||b<u)&&void 0===e.nsecs&&(c=0),1e4<=c)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");b=u,h=s;var d=(1e4*(268435455&(u+=122192928e5))+(y=c))%4294967296;i[r++]=d>>>24&255,i[r++]=d>>>16&255,i[r++]=d>>>8&255,i[r++]=255&d;var p=u/4294967296*1e4&268435455;i[r++]=p>>>8&255,i[r++]=255&p,i[r++]=p>>>24&15|16,i[r++]=p>>>16&255,i[r++]=s>>>8|128,i[r++]=255&s;for(var f=0;f<6;++f)i[r+f]=o[f];return t||v(i)}},{"./lib/bytesToUuid":4,"./lib/rng":5}],7:[function(e,t,n){var s=e("./lib/rng"),a=e("./lib/bytesToUuid");t.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||s)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[r+o]=i[o];return t||a(i)}},{"./lib/bytesToUuid":4,"./lib/rng":5}],8:[function(e,V,t){(function(W){!function(){"use strict";var s,n,r,i=null,e="object"==typeof self,o=e?self:W,t=o.Promise,a=o.process,u=Array,c=0,l=1,d=2,p="species",f="Invalid argument",g="Chaining cycle detected for promise",h="unhandledRejection",m={e:i},v=function(){},b=o.Symbol||{},y=e?function(e){t?new t(function(e){e()}).then(e):setTimeout(e)}:a.nextTick,_=function(e){var t,n=this;if(!S(n)||n._s!==s)throw P("Invalid this");if(n._s=d,e!==v){if(!k(e))throw P(f);(t=I(e)(M(n,l),M(n,c)))===m&&U(n,c,t.e)}};function w(){return b[p]||"Symbol(species)"}function S(e){return e&&"object"==typeof e}function k(e){return"function"==typeof e}function E(e,t,n){if(!t(e))throw P(n)}function T(){try{return n.apply(r,arguments)}catch(e){return m.e=e,m}}function I(e,t){return n=e,r=t,T}function x(t,n){var r=u(t),i=0;function o(){for(var e=0;e<i;)n(r[e],r[e+1]),r[e++]=s,r[e++]=s;i=0,r.length>t&&(r.length=t)}return function(e,t){r[i++]=e,r[i++]=t,2===i&&y(o)}}function C(e,t){var n,r,i,o,s=0;if(!e)throw P(f);var a=e[b.iterator];if(k(a))r=a.call(e);else{if(!k(e.next)){if(e instanceof u){for(n=e.length;s<n;)t(e[s],s++);return s}throw P(f)}r=e}for(;!(i=r.next()).done;)if((o=I(t)(i.value,s++))===m)throw k(r.return)&&r.return(),o.e;return s}function P(e){return new TypeError(e)}(function(e,t){for(var n in t)e.prototype[n]=t[n]})(_.default=_,{then:function(e,t){if(void 0===this._s)throw P();return function(e,t,n,r){k(n)&&(t._onFulfilled=n);k(r)&&(e._uh&&D("rejectionHandled",e),t._onRejected=r);e[e._pCount++]=t,e._s!==d&&O(e,t);return t}(this,R((n=_,(r=this.constructor)&&r[w()]||n)),e,t);var n,r},catch:function(e){return this.then(s,e)},finally:function(t){return this.then(function(e){return _.resolve(t()).then(function(){return e})},function(e){return _.resolve(t()).then(function(){throw e})})},_pCount:0,_pre:i,_Yaku:1}),_.resolve=function(e){return N(e)?e:A(R(this),e)},_.reject=function(e){return U(R(this),c,e)},_.race=function(e){var t=this,n=R(t),r=function(e){U(n,l,e)},i=function(e){U(n,c,e)},o=I(C)(e,function(e){t.resolve(e).then(r,i)});return o===m?t.reject(o.e):n},_.all=function(e){var n,r=this,i=R(r),o=[];function s(e){U(i,c,e)}return(n=I(C)(e,function(e,t){r.resolve(e).then(function(e){o[t]=e,--n||U(i,l,o)},s)}))===m?r.reject(n.e):(n||U(i,l,[]),i)},I(function(){Object.defineProperty(_,w(),{get:function(){return this}})})(),_._Yaku=1;var O=x(999,function(e,t){var n,r;(r=e._s?t._onFulfilled:t._onRejected)!==s?(n=I(j)(r,e._v))!==m?A(t,n):U(t,c,n.e):U(t,e._s,e._v)}),L=x(9,function(e){(function e(t){{if(t._umark)return!0;t._umark=!0}var n,r=0,i=t._pCount;for(;r<i;)if((n=t[r++])._onRejected||e(n))return!0})(e)||(e._uh=1,D(h,e))});function D(e,t){var n="on"+e.toLowerCase(),r=o[n];a&&a.listeners(e).length?e===h?a.emit(e,t._v,t):a.emit(e,t):r&&r({reason:t._v,promise:t})}function N(e){return e&&e._Yaku}function R(e){return N(e)?new e(v):(n=new e(function(e,t){if(n)throw P();r=e,i=t}),E(r,k),E(i,k),n);var n,r,i}function M(t,n){var r=!1;return function(e){r||(r=!0,n===l?A(t,e):U(t,n,e))}}function j(e,t){return e(t)}function U(e,t,n){var r=0,i=e._pCount;if(e._s===d)for(e._s=t,e._v=n,t===c&&L(e);r<i;)O(e,e[r++]);return e}function A(e,t){if(t===e&&t)return U(e,c,P(g)),e;if(t!==i&&(k(t)||S(t))){var n=I(B)(t);if(n===m)return U(e,c,n.e),e;k(n)?N(t)?F(e,t,n):y(function(){F(e,t,n)}):U(e,l,t)}else U(e,l,t);return e}function B(e){return e.then}function F(t,n,e){var r=I(e,n)(function(e){n&&(n=i,A(t,e))},function(e){n&&(n=i,U(t,c,e))});r===m&&n&&(U(t,c,r.e),n=i)}try{V.exports=_}catch(e){o.Yaku=_}}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(w,S,k){!function(e){"use strict";var o=w("./services/logging"),s=w("./platform"),t=w("./services/admin"),a=w("./services/session"),r=w("./services/event"),n=w("./services/device"),i=w("./services/tag"),u=w("./services/notification"),c=w("./services/richinbox"),l=w("./services/push"),d=w("./services/permission"),p=w("./services/tracing"),f=w("./services/preload"),g=w("./utils");function h(t){return function(e){o.error("["+t+"] Unexpected error: "+e.message)}}function m(){this.settings={}}function v(){this.settings={}}function b(){this.settings={}}function y(e,t,n){return this.settings={},this.admin=new b,this.rims=new m,this.push=new v,this.admin=new b,this.initialize(e,t,n),this}if(m.prototype={initialize:function(e){this.settings=e},onMessagesUpdated:function(e){c.onMessagesUpdated(this.settings,e)},getNewMessages:function(e,t){c.getNewMessages(this.settings,e,t)},getMoreMessages:function(e,t){c.getMoreMessages(this.settings,e,t)},getMessages:function(e){c.getMessages(this.settings,e)},markAsRead:function(e,t){c.markAsRead(this.settings,e,t)},markAsDeleted:function(e,t){c.markAsDeleted(this.settings,e,t)}},v.prototype={initialize:function(e){this.settings=e},isSupported:function(e){l.isPushSupported(this.settings,e)},subscribe:function(e){l.subscribeToPush(this.settings,e)},unsubscribe:function(e){l.unsubscribeFromPush(this.settings,e)},isSubscribed:function(e){l.isSubscribedToPush(this.settings,e)}},b.prototype={initialize:function(e){this.settings=e},enableTracing:function(e){o.info("Executing enableTracing routine."),t.enableTracing(this.settings,e)},disableTracing:function(e){o.info("Executing disableTracing routine."),t.disableTracing(this.settings,e)},debug:function(e){o.info("Executing debug routine. Retrieving SDK configuration."),t.debug(this.settings,e)},reset:function(t){o.info("resetting OL");var n=this;a.getSessionId(this.settings)&&a.endSession(this.settings,function(){l.isSubscribedToPush(n.settings,function(e){e?l.unsubscribeFromPush(n.settings,function(){s.reset(),n.settings.data.tracking_id=null,n.settings.data.prev_tracking_id=null,n.settings.data.phash=null,n.settings.data.sid=null,o.info("OL reset complete - remember to reset your notification permissions in your browser."),t&&t()}):(s.reset(),n.settings.data.tracking_id=null,n.settings.data.prev_tracking_id=null,n.settings.data.phash=null,n.settings.data.sid=null,o.info("OL reset complete - remember to reset your notification permissions in your browser."),t&&t())})})}},y.version="1.16.0",y.environment="production",y.LOG_LEVELS=o.LOG_LEVELS,y.prototype={initialize:function(e,t,n){if(!e||0===e.length)throw new Error("OL: appKey is required!");(t=t||{}).multipleSubdomains=void 0!==t.baseDomain&&null!==t.baseDomain,s.initializeStorage(t),this.settings=w("./settings").refreshSettings(y.version,e,t,this.settings),this.admin.initialize(this.settings),this.rims.initialize(this.settings),this.push.initialize(this.settings),this.admin.initialize(this.settings),o.logLevel=this.settings.logLevel,s.initialize(this),o.info("OtherLevels initialized for ",e);var r=t.multipleSubdomains?"enabled":"disabled";o.debug("Multiple subdomain support is "+r+". Base domain is "+t.baseDomain);var i=this.settings;this.settings.sessionIdleTimeoutEnabled&&a.applySessionExpiryListeners(this.settings,function(){o.debug("Session expired because page was idle"),a.endSession(i,function(){i.sessionExpiryCallback(),i._sessionEndedByExpiry=!0,o.debug("Session expired",i._sessionEndedByExpiry)})},function(){o.info("Page stopped being idle"),i._sessionEndedByExpiry&&(o.info("Restarting new session after inactivity."),a.startSession(i,i.sessionRestartedCallback),delete i._sessionEndedByExpiry)}),t.crossOriginReceiverMode&&l.setUpRemoteReceiver(),t.crossOriginReceiverMode||this.startSession(n)},startSession:function(n){var r=this.settings;a.startSession(this.settings,function(e,t){!r.preloadContent||!t&&f.hasCachedInterstitials(r)?p.trace(r,"startSession","info","Not requesting preload of interstitial(s)."):(p.trace(r,"startSession","info","Requesting preload of interstitial(s)."),f.clearCachedInterstitials(r,function(){f.preloadInterstitials(r)})),n&&n.apply(null,arguments)})},getSessionId:function(e){var t=a.getSessionId(this.settings);return e&&e(t),t},endSession:function(e){a.endSession(this.settings,e)},getAppKey:function(e){var t=this.settings.data.app_key;return e&&e(t),t},registerEvent:function(e,t,n){r.registerEvent(this.settings,e,t,n)},setTrackingId:function(e,t){var n=g.getValidTrackingId(e);if(void 0===n)throw new Error("Could not apply trackingId. Invalid trackingId supplied: "+e);var r=this.settings,i=r.data.tracking_id,o=this;a.setTrackingId(this.settings,n,function(){if(i!==n&&(c.clear(r),l.isPushSupported(r,function(e){e&&l.isSubscribedToPush(r,function(e){e&&l.updateTrackingId(r,i,n)})}),r.preloadContent&&f.clearCachedInterstitials(r,function(){f.preloadInterstitials(r)})),t){var e=Array.prototype.slice.call(arguments,0);t.apply(o,e)}})},getTrackingId:function(e){var t=a.getTrackingId(this.settings);return e&&e(t),t},setTag:function(e,t,n,r){return i.setTag(this.settings,e,t,n,r)},batchSetTag:function(e,t){return i.batchSetTag(this.settings,e,t)},getTag:function(e,t){return i.getTag(this.settings,e,t)},splitTestNotification:function(e,t,n){u.splitTestNotification(this.settings,e,t,n)},showSimpleModal:function(e,t,n,r,i){u.showSimpleModal(e,t,n,r,i)},showSplitTestAlert:function(e,t,i,o,s,a){u.splitTestNotification(this.settings,e,t,function(e,t,n){var r=i;"function"==typeof i&&(r=i(t)),u.showSimpleModal(e,r,o,function(){n(),s&&s()},function(){a&&a()})})},displayInterstitial:function(e,t,n,r,i,o){u.displayInterstitial(this.settings,e,t,n,r,i,o)},registerDevice:function(e,t){n.registerDevice(this.settings,e,t)},setPhash:function(e,t){a.setPhash(this.settings,e),t&&t()},askForPermission:function(e,t,n){d.askForPermission(this.settings,e,t,n)},getTraceEvents:function(e,t){var n,r;r=t?(n=e,t):e,p.readCachedTraceEvents(this.settings,n).then(r,h("getTraceEvents"))},clearTraceEvents:function(e){p.clearTraceEvents().then(e,h("clearTraceEvents"))}},void 0!==k&&(void 0!==S&&S.exports?S.exports=y:k.OtherLevels=y),void 0!==e&&e){var _=e.OtherLevelsObject||"_ol";e[_]=w("./platform/browser/driver")(y,e[_])}}("undefined"!=typeof window?window:null)},{"./platform":20,"./platform/browser/driver":10,"./services/admin":21,"./services/device":22,"./services/event":23,"./services/logging":24,"./services/notification":25,"./services/permission":26,"./services/preload":27,"./services/push":28,"./services/richinbox":29,"./services/session":30,"./services/tag":31,"./services/tracing":32,"./settings":33,"./utils":36}],10:[function(r,e,t){var c=r("../../utils");e.exports=function(e,t){var o,s=r("../../services/logging"),a=e;function u(){var e,t,n=arguments[0],r=Array.prototype.slice.call(arguments,1);if("function"==typeof n)n(u);else{var i;if("get"===n)return i=o?c.getDeep(o,r[0]):c.getDeep(a,r[0]),1<r.length&&"function"==typeof r[1]&&r[1](i),i;"create"===n?o=void 0!==o?(t=r,(e=o).initialize&&e.initialize.apply(e,t),e):function(e,t){function n(){return e.apply(this,t)}return n.prototype=e.prototype,new n}(a,r):o?function(e,t){if(void 0===e)return!1;for(var n=t.split("."),r=e,i=0;i<n.length&&void 0!==(r=r[n[i]]);i++);return void 0!==r}(o,n)?function(e,t,n){if(void 0!==e){for(var r=t.split("."),i=e,o=0;o<r.length-1&&void 0!==(i=i[r[o]]);o++);void 0!==i&&i[r[r.length-1]].apply(i,n)}}(o,n,r):s.debug("Unknown function called",n):s.error("OtherLevels object has not been initialized yet")}}if(t&&t.q)for(var n=0;n<t.q.length;n++)u.apply(u,t.q[n]);return u}},{"../../services/logging":24,"../../utils":36}],11:[function(e,t,n){var i=e("jschannel"),c=e("../../utils"),r=c.Promise;function o(e,t){this.url=e,this.id="ol-remote-id",this.scope=t,this._channel=null,this.timeout=1e3}function s(t,n){return function(){var e=Array.prototype.slice.call(arguments,0);return t.send(n,e)}}function a(n,r){return function(t,e){n[r].apply(n,e).then(function(e){t.complete(e)},function(e){t.error(e)}),t.delayReturn(!0)}}o.prototype._set=function(e){this._channel=e},o.prototype._get=function(e){if(null===this._channel){var t=window.document.getElementById(this.id),n=this;if(t)if(t.onload||e(new Error('"onload" method missing on iframe')),t.loaded)this._channel=i.build({window:t.contentWindow,origin:"*",scope:this.scope,reconnect:!0}),e(null,this._channel);else var r=setInterval(function(){n._channel&&(e(null,n._channel),clearInterval(r))},100);else(t=window.document.createElement("iframe")).setAttribute("src",this.url),t.setAttribute("id",this.id),t.setAttribute("visibility","hidden"),t.style="width: 0px; height: 0px; border:0px; display:none;",t.onload=function(){t.loaded=!0,n._set(i.build({window:t.contentWindow,origin:"*",scope:n.scope})),e(null,n._channel)},document.getElementsByTagName("body")[0].appendChild(t)}else e(null,this._channel)},o.prototype.send=function(s,a){var u=this;return new r(function(i,o){u._get(function(e,t){if(e)o(e);else{var n=[];for(var r in a)n.push(c.deepCopy(a[r]));t.call({method:s,params:n,success:function(e){i(e)},error:o,timeout:u.timeout})}})})},t.exports={proxySenderObject:function(e,t,n){var r={_iframeSender:new o(t,n)};for(var i in e)e.hasOwnProperty(i)&&(r[i]=s(r._iframeSender,i));return r},proxyReceiverObject:function(e,t){var n={_channel:i.build({window:window.parent,origin:"*",scope:t,reconnect:!0}),_obj:e};for(var r in e)e.hasOwnProperty(r)&&n._channel.bind(r,a(e,r))}}},{"../../utils":36,jschannel:1}],12:[function(e,t,n){var r,s,a,u,o=e("./xhr"),i=e("./storage"),c=e("./modal"),l=e("./modalTrigger"),d=e("./push"),p=null,f=!1;function g(e){var t;try{t=JSON.parse(e.message)}catch(e){}return{type:"api",message:t&&t.error?t.error:e.message,url:e.url,responseJSON:t,statusCode:e.statusCode}}window.console||(window.console={});var h={logger:function(){for(var e=function(e){var t=window.console[e];return function(){void 0===t.apply?t(Array.prototype.slice.call(arguments).join(" ")):t.apply(window.console,arguments)}},t={log:e("log"),debug:e("log")},n=["info","warn","error","debug"],r=0;r<n.length;r++){var i=n[r];window.console[i]?t[i]=e(i):t[i]=e("log")}return t},initializeStorage:function(e){r=i.getStorage(e)},initialize:function(){h.log=e("../../services/logging"),h.log.info(r)},iframeProxy:e("./iframeProxy"),http:{post:function(e,t,n,r){var i;h.log.debug("POST",e,n?"as json":"as form",t),i=n?t:{payload:JSON.stringify(t)},o.post(e,i,n,function(e){e.responseJSON?h.log.debug("Received JSON: ",e.responseJSON):h.log.debug("Received text: ",e.responseText),r&&r(null,e.responseJSON||e.responseText)},function(e){r&&r(g(e))})},put:function(e,t,n,r){var i;h.log.debug("PUT",e,n?"as json":"as form",t),i=n?t:{payload:JSON.stringify(t)},o.put(e,i,n,function(e){e.responseJSON?h.log.debug("Received JSON: ",e.responseJSON):h.log.debug("Received text: ",e.responseText),r&&r(null,e.responseJSON||e.responseText)},function(e){r&&r(g(e))})},get:function(e,t){h.log.debug("GET",e),o.get(e,function(e){e.responseJSON?h.log.debug("Received JSON: ",e.responseJSON):h.log.debug("Received text: ",e.responseText),t&&t(null,e.responseJSON||e.responseText)},function(e){t&&t(g(e))})},delete:function(e,t,n,r){var i;h.log.debug("DELETE",e,n?"as json":"as form",t),i=n?t:{payload:JSON.stringify(t)},o.delete(e,i,n,function(e){e.responseJSON?h.log.debug("Received JSON: ",e.responseJSON):h.log.debug("Received text: ",e.responseText),r&&r(null,e.responseJSON||e.responseText)},function(e){r&&r(g(e))})}},platformSettings:function(){var e=navigator.language||navigator.userLanguage,t=(new Date).getTimezoneOffset();return t=t<0?"+"+-t:"-"+t,{data:{language:e.substring(0,2),timezone:t,cookiesEnabled:navigator.cookieEnabled}}},getStoredValue:function(e){return r.get(e)},setStoredValue:function(e,t,n){r.set(e,t,n)},clearStoredValue:function(e){r.set(e)},getPhashFromHashFragment:function(e){e=e||"phash=";var t=new RegExp(e+"(.{6,12})$"),n=t.exec(window.location.hash);return n?(window.location.hash=window.location.hash.replace(t,""),n[1]):""},showSimpleModal:function(e,t,n,r,i){new c({confirmButtonLabel:n,onConfirm:r,onDismiss:i}).show(e,t)},showEmptyModal:function(e,t,n,r){var i=new c({showConfirmButton:!1,showHeader:!1,onDismiss:r,extraClasses:e,eventHandlers:n});return i.show(t),i},applyModalTrigger:function(e,t,n){h.log.debug("applying modal trigger."),l.setModalTriggerStrategy(e,t,n)},push:{isSupported:d.isSupported,isHttpWebPushSupported:d.isHttpWebPushSupported,requiresDeliverabilityDelete:d.requiresDeliverabilityDelete,subscribe:function(e){return d.register(e,r)},unsubscribe:function(e){return d.unregister(e,h.getBrowserName(),r)},isSubscribed:function(e){return d.isRegistered(e,r)},getSubscriptionDetails:function(e){return d.getSubscriptionDetails(e,r)},saveSubscriptionDetails:function(e,t){return d.saveSubscriptionDetails(e,r,t)},removeSubscriptionDetails:function(e){return d.removeSubscriptionDetails(e,r)},getNotificationPermission:function(e){return d.getNotificationPermission(e,r)},getLastPushMessage:d.getLastPushMessage,setTracingId:d.setTracingId,setTracingEnabled:d.setTracingEnabled,setTracingDisabled:d.setTracingDisabled,readTraceEvents:d.readTraceEvents,clearTraceEvents:d.clearTraceEvents,getServiceWorkerConfig:d.getServiceWorkerConfig,saveRecipientDetails:d.saveRecipientDetails},getOLParametersFromQueryString:function(e){(e=e||{}).phashParamName=e.phashParamName||"_olph",e.trackingIdParamName=e.trackingIdParamName||"_oltid",e.sessionIdParamName=e.sessionIdParamName||"_olsid";var i=Object.create(null);return window.location.search.trim().replace(/^(\?|#|&)/,"").split("&").forEach(function(e){var t=e.replace(/\+/g," ").split("="),n=t.shift(),r=0<t.length?t.join("="):void 0;n=decodeURIComponent(n),r=void 0===r?null:decodeURIComponent(r),void 0===i[n]?i[n]=r:Array.isArray(i[n])?i[n].push(r):i[n]=[i[n],r]}),{phash:i[e.phashParamName],trackingId:i[e.trackingIdParamName],sessionId:i[e.sessionIdParamName]}},getBrowserName:function(){var e=-1!==navigator.userAgent.toLowerCase().indexOf("chrome"),t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");return-1!==navigator.userAgent.toLowerCase().indexOf("safari")&&!e?"safari":window.chrome||e?"chrome":t?"firefox":void 0},getUserAgentHeader:function(){return navigator.userAgent},getOLScriptUrls:function(){var e=[];if(window.document)for(var t=document.getElementsByTagName("script"),n=0;n<t.length;n++)t[n].src&&0<t[n].src.indexOf("otherlevels")&&e.push(t[n].src);return e},documentVisible:function(){return document.hidden?"hidden":"visible"},reset:function(){i.reset()},applySessionExpiryListeners:function(e,t,i){s=e.documentVisibilityChecker?e.documentVisibilityChecker:h.documentVisible,h.log.info("Applying visibility listeners with session expiration: "+e.sessionExpirationSeconds);var n="hidden";u=t;function o(){h.log.info("Your session has expired due to inactivity"),p=null,void 0!==u&&u()}function r(e){h.log.debug("visibility change",e);var t="visible",n="hidden",r={focus:t,focusin:t,pageshow:t,blur:n,focusout:n,pagehide:n};"hidden"===((e=e||window.event).type in r?r[e.type]:s())?null===p&&(h.log.info("Setting session idle timeout"),p=window.setTimeout(o,a)):(null!==p&&(h.log.info("clearing idle timer"),window.clearTimeout(p),p=null),void 0!==i&&i())}a=9e5,0<e.sessionExpirationSeconds&&(a=1e3*e.sessionExpirationSeconds),f||(n in document?document.addEventListener("visibilitychange",r):(n="mozHidden")in document?document.addEventListener("mozvisibilitychange",r):(n="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",r):(n="msHidden")in document?document.addEventListener("msvisibilitychange",r):"onfocusin"in document?document.onfocusin=document.onfocusout=r:window.onpageshow=window.onpagehide=window.onfocus=window.onblur=r,f=!0)}};t.exports={logger:h.logger,initialize:h.initialize,initializeStorage:h.initializeStorage,http:{post:h.http.post,put:h.http.put,get:h.http.get,delete:h.http.delete},push:h.push,reset:h.reset,platformSettings:h.platformSettings,getStoredValue:h.getStoredValue,setStoredValue:h.setStoredValue,clearStoredValue:h.clearStoredValue,getPhashFromHashFragment:h.getPhashFromHashFragment,showSimpleModal:h.showSimpleModal,showEmptyModal:h.showEmptyModal,applyModalTrigger:h.applyModalTrigger,getOLParametersFromQueryString:h.getOLParametersFromQueryString,iframeProxy:h.iframeProxy,getBrowserName:h.getBrowserName,getUserAgentHeader:h.getUserAgentHeader,getOLScriptUrls:h.getOLScriptUrls,applySessionExpiryListeners:h.applySessionExpiryListeners}},{"../../services/logging":24,"./iframeProxy":11,"./modal":13,"./modalTrigger":14,"./push":15,"./storage":18,"./xhr":19}],13:[function(e,t,n){var i=e("../../utils");function r(e){e=e||{},this._id=e.id||"ol-"+(new Date).getTime()+Math.round(100*Math.random()),this._confirmButtonLabel=e.confirmButtonLabel||"OK",this._showCloseButton=void 0===e.showCloseButton||e.showCloseButton,this._onDismiss=e.onDismiss,this._onConfirm=e.onConfirm,this._showConfirmButton=void 0===e.showConfirmButton||e.showConfirmButton,this._extraClasses=e.extraClasses||[];var r=this;e.eventHandlers&&(r._eventHandlers={},i.forEachInObject(e.eventHandlers,function(e,n){r._eventHandlers[e]=function(e){var t={};t.close=r._closeModal,n(e,t)}})),this._showModal=function(e){e.className=e.className.replace(/(?:^|\s)ol-hide(?!\S)/g,""),this._emitEvent("ol-modal-show")},this._closeModal=function(){r.close(),r=void 0},this._bindButtonClick=function(e,t,n){if(e){e.innerHTML=t;var r=this;e.onclick=function(){r.close(),n&&n()}}},this._showHeader=void 0===e.showHeader||e.showHeader,this._bindConfirmButton=function(e){this._bindButtonClick(e,this._confirmButtonLabel,this._onConfirm)},this._bindCloseButton=function(e){this._bindButtonClick(e,"&times;",this._onDismiss)},this._attachOrRemoveEvents=function(e){if(this._eventHandlers&&this._eventHandlers!=={}){var s="attach"===e?this._addEventListener:this._removeEventListener;i.forEachInObject(this._eventHandlers,function(e,t){var n=e.split(" "),r=n[0],i=n[1],o=document.getElementById(i);o&&s(o,r,t)})}},this._attachEvents=function(){this._attachOrRemoveEvents("attach")},this._removeEvents=function(){this._attachOrRemoveEvents("remove")},this.show=function(e,t){var n=document.createElement("div");n.innerHTML=e;var r=this._findElementByClass(n,"ol-modal");if(r)this._bindCloseButton(this._findElementByClass(r,"ol-close")),this._bindConfirmButton(this._findElementByClass(r,"ol-confirm"));else{r=this._newElement("div","ol-modal "+this._extraClasses.join(" "));var i=this._newElement("div","ol-content",r);if((t||this._showCloseButton)&&this._showHeader){var o=this._newElement("div","ol-header",i);if(t)this._newElement("div","ol-title",o).innerHTML=t;if(this._showCloseButton&&this._bindCloseButton(this._newElement("div","ol-close",o)),this._showConfirmButton){var s=this._newElement("div","ol-footer",i);this._bindConfirmButton(this._newElement("div","ol-confirm",s))}}else if(!this._showHeader&&this._showCloseButton){var a=this._newElement("div","ol-close",i);this._bindCloseButton(a)}this._newElement("div","ol-body",i).innerHTML=e}return r.id=this._id,document.body.firstChild.parentNode.insertBefore(r,document.body.firstChild),this._attachEvents(),this._emitEvent("ol-modal-create"),r},this.close=function(){var e=this,t=document.getElementById(this._id);this._emitEvent("ol-modal-hide"),this._hideModal(t),setTimeout(function(){e._emitEvent("ol-modal-remove"),e._removeEvents(),t.parentNode&&t.parentNode.removeChild(t),t=null},500)}}r.prototype._findElementByClass=function(e,t){return e.getElementsByClassName?e.getElementsByClassName(t)[0]:e.querySelector("."+t)},r.prototype._hideModal=function(e){e.className+=" ol-hide"},r.prototype._emitEvent=function(e,t){var n;"function"==typeof CustomEvent?n=new CustomEvent(e,t):(n=document.createEvent("CustomEvent")).initEvent(e,!0,!0),n&&document.dispatchEvent(n)},r.prototype._addEventListener=function(e,t,n,r){n&&(e.addEventListener?e.addEventListener(t,n,!r):e.attachEvent&&e.attachEvent("on"+t,n))},r.prototype._removeEventListener=function(e,t,n){n&&(e.removeEventListener?e.removeEventListener(t,n,!0):e.attachEvent&&e.detachEvent("on"+t,n))},r.prototype._newElement=function(e,t,n){var r=document.createElement(e);return r.className=t,n&&n.appendChild(r),r},t.exports=r},{"../../utils":36}],14:[function(e,t,n){function p(e,t){return e.getAttribute(t)||(0===t.indexOf("data-")?e.getAttribute(t.substring(5)):e.getAttribute("data-"+t))}function f(e,t){return setTimeout(function(){t()},100),"immediate-trigger"}t.exports={setModalTriggerStrategy:function(e,t,n){var r=e.trace||function(){},i=document.createElement("html"),o=document.createElement("body");o.innerHTML=t,i.appendChild(o);var s,a,u,c,l,d=i.childNodes[0].firstChild;switch(p(d,"ol-trigger")){case"exit-intent":return r("modal.trigger.strategy","info","Trigger strategy for modal content is exit-intent"),s=n,a=document,u="mouseout",c=function e(t){var n,r,i,o=(t=t||window.event).relatedTarget||t.toElement;o&&"HTML"!==o.nodeName||(s(),n=document,r="mouseout",(i=e)&&(n.removeEventListener?n.removeEventListener(r,i,!0):n.attachEvent&&n.detachEvent("on"+r,i)))},a.addEventListener?a.addEventListener(u,c,!l):a.attachEvent&&a.attachEvent("on"+u,c),"exit-intent-trigger";case"timed":return r("modal.trigger.strategy","info","Trigger strategy for modal content is timed"),function(e,t){var n=p(e,"ol-trigger-delay");if(!n)return f(0,t);var r=parseInt(n,10);return r?(setTimeout(function(){t()},1e3*r),"timer-trigger"):f(0,t)}(d,n);default:return r("modal.trigger.strategy","info","Trigger strategy for modal content is immediate"),"immediate-trigger"}}}},{}],15:[function(e,t,n){"safari"in window&&"pushNotification"in window.safari?t.exports=e("./safari"):t.exports=e("./w3c")},{"./safari":16,"./w3c":17}],16:[function(e,t,n){var u=e("../../../utils").Promise;t.exports={isSupported:function(){var e=!!("safari"in window&&"pushNotification"in window.safari);return u.resolve(e)},isHttpWebPushSupported:function(){return u.resolve(!0)},requiresDeliverabilityDelete:function(){return u.resolve(!1)},getSubscriptionDetails:function(e){var t=window.safari.pushNotification.permission(e.safariWebsitePushId);return t&&t.deviceToken?u.resolve({deviceToken:t.deviceToken}):u.resolve()},saveSubscriptionDetails:function(){return u.resolve()},removeSubscriptionDetails:function(){return u.resolve()},register:function(e){var t=e.trace||function(){},i=e.server.jsSdkService+"/safari",o=e.safariWebsitePushId,s=e.data.app_key,a=e.data.tracking_id;if(o){return function r(e){return"default"===e.permission?(t("push.subscribe.safari","info","Requesting permissions on Safari",{webserviceUrl:i,websitePushID:o,payload:{appKey:s,trackingId:a}}),new u(function(t,n){try{window.safari.pushNotification.requestPermission(i,o,{appKey:s,trackingId:a},function(e){r(e).then(t,n)})}catch(e){n(e)}})):"granted"===e.permission?(t("push.subscribe.safari","info","Permissions granted on Safari",{websitePushID:o}),u.resolve({platform:"safari",websitePushId:o,deviceToken:e.deviceToken})):"denied"===e.permission?(t("push.subscribe.safari","info","Permissions denied on Safari",{websitePushID:o}),u.reject(new Error("Web push permission denied for this website"))):u.reject(new Error("Unknown permission value: "+e.permission))}(window.safari.pushNotification.permission(o))}return u.reject(new Error('Cannot subscribe without a valid "websitePushID"'))},unregister:function(){return u.resolve()},isRegistered:function(e){if(e.safariWebsitePushId){var t=window.safari.pushNotification.permission(e.safariWebsitePushId);return u.resolve("granted"===t.permission)}return u.reject(new Error('Cannot check push registration without "safariWebsitePushId"'))},getNotificationPermission:function(e){var t=e.safariWebsitePushId;if(t){var n=window.safari.pushNotification.permission(t);return u.resolve(n.permission)}return u.reject(new Error("Expected website push ID but got: "+t))},getLastPushMessage:function(){return u.resolve()},setTracingId:function(){return u.resolve()},setTracingEnabled:function(){return u.resolve()},setTracingDisabled:function(){return u.resolve()},readTraceEvents:function(){return u.resolve([])},clearTraceEvents:function(){return u.resolve([])},saveRecipientDetails:function(){return u.resolve()},getServiceWorkerConfig:function(){return u.resolve({status:"not supported on Safari"})}}},{"../../../utils":36}],17:[function(e,t,n){var r,i,c=e("../../../utils/browserpush.js"),l=e("../../../utils/index.js"),s=l.Promise,o="ol-service-worker",a="last_message",u="app_key",d="tracking_id",p=c.traceDbName,f="OL_last_permission",g="OL_SubscriptionEndpoint";function h(){return r||(r=new c.IndexedDBWrapper(o,1)),r}function m(){return!i&&c.isIndexedDBSupported()&&(i=new c.IndexedDBWrapper(p,1,{autoIncrement:!0})),i}function v(){return window.location!==window.parent.location}function b(e,t){var n=h();return n.put(u,e).then(function(){return n.put(d,t)})}function y(e,t){return h().put(e,t)}t.exports={isSupported:function(){var e=window.PushManager||navigator.push,t=window.Notification,n=navigator.serviceWorker,r=!!(e&&t&&n),i=!!document.documentMode,o=!i&&!!window.StyleMedia;return s.resolve(r&&!(i||o))},isHttpWebPushSupported:function(){return s.resolve(!1)},requiresDeliverabilityDelete:function(){return s.resolve(!0)},getSubscriptionDetails:function(e,t){var n=t.get(g);return n?s.resolve({subscriptionUrl:n}):s.resolve()},saveSubscriptionDetails:function(e,n,r){return new s(function(e,t){try{n.set(g,r.subscriptionUrl,l.getLongTermExpiry()),e()}catch(e){t(e)}})},removeSubscriptionDetails:function(e,n){return new s(function(e,t){try{n.set(g,null),e()}catch(e){t(e)}})},register:function(s,a){var u=s.trace||function(){};return l.executeWithPromise(window.Notification.requestPermission).then(function(e){if(a.set(f,e,l.getLongTermExpiry()),u("push.subscribe.permission","info",'Notification permissions are "'+e+'".',{permission:e}),"granted"===e)return(t=s.serviceWorkerLocation,n=s.serviceWorkerScope,r=s.vapidPublicKey,i=u,o={scope:n},i("push.subscribe.worker","info","Registering worker",{workerPath:t,workeroptions:o}),navigator.serviceWorker.register(t,o).then(function(){return navigator.serviceWorker.ready}).then(function(e){var t={userVisibleOnly:!0};return void 0!==r&&(t={userVisibleOnly:!0,applicationServerKey:l.urlBase64ToUint8Array(r)}),e.pushManager.subscribe(t).then(void 0,function(e){throw"denied"===window.Notification.permission?new Error("User permanently disabled permissions for this website"):e})})).then(function(e){return u("push.subscribe.worker","info","Registered worker and got subscription"),c.getDeliveryDetails(e)}).then(void 0,function(e){throw u("push.subscribe.worker","error","Error while registering worker",{error:e.message,stack:e.stack}),e});throw"denied"===e?(u("push.subscribe.permission","info","Notification permissions are denied.",{permission:e}),new Error("User permanently disabled permissions for this website")):new Error("User ignored permission request for this website. Subscription attempt can be repeated");var t,n,r,i,o}).then(function(e){return b(s.data.app_key,s.data.tracking_id).then(function(){return e})})},unregister:function(e,t,n){var r=e.trace||function(){};return(v()&&"chrome"===t?new s(function(e){r("push.unsubscribe.chrome","info","Returning stored subscription URL for Chrome.");var t=n.get(g);"undefined"!==t&&null!==t?e({subscriptionUrl:t}):e()}):navigator.serviceWorker.ready.then(function(e){if(e.active)return e.pushManager.getSubscription().then(function(e){if(e){var t=c.getDeliveryDetails(e);return e.unsubscribe().then(function(){return r("push.unsubscribe.pushSubscription","info","platform push - subscription found and unsubscribed.",t),t})}r("push.unsubscribe.pushSubscription","info","Could not find pushSubscription.")});r("push.unsubscribe.service-worker","info","Could not find service worker registration.")})).then(function(e){return n.set(f,null),(t=h(),t.delete(u).then(function(){return t.delete(d)})).then(function(){return e});var t})},isRegistered:function(e,n){var r=e.trace||function(){};return navigator.serviceWorker&&navigator.serviceWorker.ready?v()?h().get("sw_keepalive_timestamp").then(function(e){return!e||parseInt(e,10)+6048e5<(new Date).getTime()}).catch(function(){return!0}).then(function(e){var t="granted"===n.get(f)&&!e;return r("push.isRegistered.iFrame.permission","info",'Notification permissions are "'+window.Notification.permission+'".',{permission:window.Notification.permission}),r("push.isRegistered.iFrame","info",'isReadyToResubscribe: "'+e+'".',{isReady:e}),t},function(e){return r("push.isRegistered.iFrame.error","info","Error with push.isRegistered in iFrame. Handling this as if the user is not subscribed.",{error:e}),!1}):navigator.serviceWorker.getRegistration(e.serviceWorkerScope).catch(function(){return!!navigator.serviceWorker.ready}).then(function(t){return!(!t||!t.active)&&t.pushManager.permissionState({userVisibleOnly:!0}).then(function(e){return"granted"===e&&t.pushManager.getSubscription().catch(function(){return!1}).then(function(e){return!!e})})}):(r("push.isRegistered.noserviceworker","info","isRegistered found no service worker support."),s.resolve(!1))},getNotificationPermission:function(e,t){var n=e.trace||function(){};if(Notification&&Notification.permission){var r=Notification.permission;if(v()){var i=t.get(f);n("push.getNotificationPermission.iFrame","info",'permission: "'+(r="undefined"!==i&&null!==i?i:"default")+'".',{iFrame:v(),browserPermission:Notification.permission,storedPermission:i})}return s.resolve(r)}return s.reject(new Error("Notification permissions not supported"))},getLastPushMessage:function(){return h().get(a).then(function(e){return h().delete(a),e}).catch(function(){h().delete(a)})},setTracingId:function(e){return y(c.tracingIdStorageKey,e)},setTracingEnabled:function(){return y(c.tracingEnabledKey,!0)},setTracingDisabled:function(){return e=c.tracingEnabledKey,h().delete(e);var e},readTraceEvents:function(){var e=m();return e?e.getAll().then(function(e){return e.map(function(e){return JSON.parse(e)})}):s.resolve([])},clearTraceEvents:function(){var e=m();return e?e.clear().then(function(){}):s.resolve()},getServiceWorkerConfig:function(){if(navigator.serviceWorker&&navigator.serviceWorker.controller){var e=navigator.serviceWorker.ready.then(function(n){if(n){var t=h(),e=["oldSubscription","newSubscription","endpoint","payload"],r=e.map(function(e){return t.get("ol-sw.subscription-change."+e).catch(function(e){return"could not get: "+e.message})});return s.all(r).then(function(r){return e.reduce(function(e,t,n){return e[t]=r[n],e},{})}).then(function(e){var t={scope:n.scope,subscriptionChangeTrace:e};return n.active?n.pushManager.getSubscription().then(function(e){return t.subscriptionEndpoint=e?e.endpoint:"undefined",t.status=n.active.state,t.scriptURL=n.active.scriptURL,t}):(n.installing?(t.status=n.installing.state,t.scriptURL=n.installing.scriptURL):n.waiting&&(t.status=n.waiting.state,t.scriptURL=n.waiting.scriptURL),t)})}return{status:"no service worker registration present"}});return new s(function(t,n){var r=!1;e.then(function(e){r=!0,t(e)},function(e){r=!0,n(e)}),setTimeout(function(){r||t({status:"not ready"})},7e3)})}return s.resolve({status:"not installed"})},saveRecipientDetails:function(e,t){return b(e,t)}}},{"../../../utils/browserpush.js":34,"../../../utils/index.js":36}],18:[function(e,t,n){var u=e("../../utils/index.js"),s="ol-",i=null,c="ol-exp-",l={set:function(e,t,n){""===t||null==t?(window.localStorage.removeItem(c+e),window.localStorage.removeItem(e)):(window.localStorage.setItem(e,t),n?window.localStorage.setItem(c+e,n.getTime()):window.localStorage.removeItem(c+e))},get:function(e){var t=window.localStorage.getItem(e),n=window.localStorage.getItem(c+e);return null===t?null:n&&new Date(parseInt(n)).getTime()<(new Date).getTime()?(window.localStorage.removeItem(e),window.localStorage.removeItem(c+e),null):t},clear:function(){window.localStorage.clear()},isSupported:function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(e){return!1}}(),name:"localstorage"},d={setDomain:function(e){i=e},set:function(e,t,n){var r=s+e+"="+(""===t||null==t?"":t)+";path=/";n&&(r+=";expires="+n.toGMTString()),i&&"localhost"!==i&&(r+=";domain="+i),document.cookie=r},get:function(e){for(var t=s+e+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var i=n[r];" "===i.charAt(0);)i=i.substring(1,i.length);if(i.substring(0,t.length)===t){var o=i.substring(t.length,i.length);return""===o?null:o}}return null},clear:function(){for(var e=document.cookie.split(";"),t=0;t<e.length;t++){var n=e[t].trim();if(n.substring(0,s.length)===s){var r=u.arrayIndexOf(n,"="),i=-1<r?n.substr(s.length,r-s.length):n;d.set(i,"",new Date(-1))}}e=document.cookie.split(";")},migrateLocalStorageData:function(e,t){var n=window.location.hostname;if(l.isSupported){var r,i,o=[];for(r=0;r<window.localStorage.length;r++)if(null!==(i=window.localStorage.key(r))&&i.substring(0,7)!==c&&"OL_"===i.substring(0,3)){var s=window.localStorage.getItem(i);if(o.push(i),null!==s&&(null===d.get(i)||n===t)){var a=window.localStorage.getItem(c+i);a=null!==a?new Date(parseInt(a)):u.getLongTermExpiry(),d.set(i,s,a)}}for(r=0;r<o.length;r++)l.set(o[r],null)}},isSupported:!0,name:"cookiestorage"};(d.alternativeStorage=l).alternativeStorage=d,t.exports={getStorage:function(e){if(void 0!==e&&e.multipleSubdomains||!l.isSupported){var t=d;e.multipleSubdomains&&t.setDomain(e.baseDomain);var n=void 0===e.dataMigrationSubdomain?e.primarySubdomain:e.dataMigrationSubdomain;return t.migrateLocalStorageData(e.baseDomain,n),t}return l},reset:function(){d.clear(),l.isSupported&&l.clear()},localStorage:l,cookieStorage:d}},{"../../utils/index.js":36}],19:[function(e,t,n){function c(){try{return new window.XMLHttpRequest}catch(e){}}function o(e,t,n,r,i,o){var s=c();s.open(e,t,!0);var a=r?"application/json; charset=utf-8":"application/x-www-form-urlencoded; charset=utf-8";s.setRequestHeader("Content-Type",a),s.setRequestHeader("X-Requested-With","XMLHttpRequest"),n&&(r||"string"==typeof n?"string"!=typeof n&&(n=JSON.stringify(n)):n=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")}(n));var u=function(){if(s.responseText)try{s.responseJSON=JSON.parse(s.responseText)}catch(e){}var e;200<=s.status&&s.status<300?i&&i(s):(0!==s.status||s.responseText?((e=new Error(s.responseText||"API response status: "+s.status)).statusCode=s.status,e.url=t):((e=new Error("Could not connect to the API")).url=t,e.statusCode=0),o&&o(e))};s.onreadystatechange=function(){4===s.readyState&&u()},s.onerror=u,s.send(n||null)}var r={post:function(e,t,n,r,i){o("POST",e,t,n,r,i)},put:function(e,t,n,r,i){o("PUT",e,t,n,r,i)},get:function(e,t,n){o("GET",e,null,!0,t,n)},delete:function(e,t,n,r,i){o("DELETE",e,t,n,r,i)}};t.exports={isSupported:void 0!==c(),post:r.post,put:r.put,get:r.get,delete:r.delete}},{}],20:[function(e,t,n){t.exports=e("./browser")},{"./browser":12,"./mock":void 0,"./titanium":void 0}],21:[function(e,t,n){var u=e("../platform"),c=e("./push"),r=e("./logging"),i=e("./tracing"),o=e("../utils");var s={enableTracing:function(e,t){e.tracingEnabled=!0,i.enableTracing(e),i.trace(e,"tracer.enabled","info","Tracer enabled on page",location),o.isHTTPS()||o.isLocalhost()||r.info("WARNING: Dynamically enabling tracing in an HTTP cross-origin configuration may inadvertantly modify the tracing settings of the remote service worker."),u.setStoredValue("OL_TraceEnabled",e.tracingEnabled,o.getLongTermExpiry()),t&&t(e.tracingEnabled)},disableTracing:function(e,t){e.tracingEnabled=!1,o.isHTTPS()||o.isLocalhost()||r.info("WARNING: Dynamically disabling tracing in an HTTP cross-origin configuration may inadvertantly modify the tracing settings of the remote service worker.");var n=function(){u.setStoredValue("OL_TraceEnabled",e.tracingEnabled,o.getLongTermExpiry()),t&&t(e.tracingEnabled)};i.disableTracing(e).then(n,n)},debug:function(o,s){var a={};c.isPushSupported(o,function(i){c.isSubscribedToPush(o,function(r){c.getNotificationPermission(o,function(n){c.getServiceWorkerConfig(o).then(function(e){var t=u.getStoredValue("OL_WEB_DEVICE_ID");return a={app:{app_key:o.data.app_key,app_name:o.data.app_name,last_install_time:o.data.lit,last_clean_install_time:o.data.acit,version:o.data.lv},user_data:{current_phash:o.data.phash,tracking_id:o.data.tracking_id,prev_tracking_id:o.data.prev_tracking_id,session_id:o.data.sid,session_length_ms:o.data.session_length,average_session_length_ms:o.data.average_session_length,web_device_id:t},web_push:{is_supported:i,is_subscribed:r,notification_permission:n},service_worker:e,configuration:{session_expiration_seconds:o.sessionExpirationSeconds,notification_yes_url:o.permissionUrls.notificationYes,cross_origin_receiver_url:o.crossOriginReceiverUrl,cross_origin_receiver_mode:o.crossOriginReceiverMode,multiple_subdomains:o.multipleSubdomains,primary_subdomain:o.primarySubdomain,data_migration_subdomain:o.dataMigrationSubdomain,preload_content:o.preloadContent},endpoints:o.server,platformSettings:function(){var e=u.platformSettings().data,t={};if(t.browser=u.getBrowserName(),u.getUserAgentHeader&&(t.user_agent=u.getUserAgentHeader()),u.getOLScriptUrls&&(t.ol_scripts=u.getOLScriptUrls()),"undefined"!==e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}()},s&&s(a),a})})})})}};t.exports={debug:s.debug,enableTracing:s.enableTracing,disableTracing:s.disableTracing}},{"../platform":20,"../utils":36,"./logging":24,"./push":28,"./tracing":32}],22:[function(e,t,n){var i=e("./logging"),o=e("../platform"),s=e("../utils"),r={registerDevice:function(e,t,n){i.info("registerDevice",t);var r={appkey:e.data.app_key,acit:e.data.acit,lv:e.data.lv,trackingid:e.data.tracking_id,device_id:e.data.device_id,platform:e.data.platform,sid:e.data.sid,phash:e.data.phash?e.data.phash:"",type:"register",devicetoken:t};o.http.post(e.server.pushEndpoint,r,!0,s.nodeCallbackForTwo(n,e.onError))}};t.exports={registerDevice:r.registerDevice}},{"../platform":20,"../utils":36,"./logging":24}],23:[function(e,t,n){var s=e("./logging"),r=e("../platform"),a=e("../utils"),u={queue:new(e("../utils/sequeue"))(r.http),registerEvent:function(e,t,n,r,i){s.info("registerEvent",t,n);var o={event_type:t,event_label:n};a.extend(o,e.data),i&&(o.phash=i),u.queue.add("post",[e.server.apiEndpoint+"/register_app_event",o,!1],a.nodeCallbackForTwo(r,e.onError))}};t.exports={registerEvent:u.registerEvent}},{"../platform":20,"../utils":36,"../utils/sequeue":37,"./logging":24}],24:[function(e,t,n){var r={debug:1,info:2,warn:3,error:4,off:5},i=e("../platform").logger(),o=e("../utils"),s={LOG_LEVELS:r,logLevel:r.warn,debug:function(){s.logLevel<=r.debug&&s.performLog("DEBUG",i.debug,Array.prototype.slice.call(arguments))},info:function(){s.logLevel<=r.info&&s.performLog("INFO",i.info,Array.prototype.slice.call(arguments))},warn:function(){s.logLevel<=r.warn&&s.performLog("WARN",i.warn,Array.prototype.slice.call(arguments))},error:function(){s.logLevel<=r.error&&s.performLog("ERROR",i.error,Array.prototype.slice.call(arguments))},trace:function(){s.performLog("INFO",i.info,Array.prototype.slice.call(arguments))},performLog:function(e,t,n){if(i&&i.log){var r="";o.isTopWindow()||(r="("+o.getPageUrl()+")"),n.unshift("OL "+r+"["+e+"]:"),(t||i.log).apply(i,n)}}};t.exports=s},{"../platform":20,"../utils":36}],25:[function(e,t,n){var m=e("./logging"),v=e("../platform"),b=e("../utils"),y=e("./event"),_=e("./session"),w=e("./tracing"),S={markInterstitialAsDisplayed:function(t,e){var n={phash:e.phash,templateId:e.templateid,splitId:e.splitid},r=t.server.contentEndpoint+"/"+t.data.app_key+"/"+t.data.tracking_id+"/interstitial/v2/mark-displayed";v.http.post(r,n,!0,b.nodeCallbackForTwo(function(){m.debug("Successfully marked interstitial as displayed.")},function(e){m.error("Error marking interstitial as displayed.",e),t.onError&&t.onError(e)}))},receivedPushNotification:function(e,t){_.setPhash(e,t.p)},splitTestNotification:function(s,e,t,a){if(e&&t&&a){var n={pushtext:e,campaigntoken:t,responsetype:"json",realtime_filtering:!0};s.data.tracking_id&&(n.trackingid=s.data.tracking_id),s.data.phash&&(n.phash=s.data.phash),v.http.post(s.server.mdnEndpoint+"/message/analytics",n,!0,b.nodeCallbackForTwo(function(e){if(e&&0!==e.errorcode){var t=e.errorinfo?e.errorinfo:"Unexpected error received";m.error("Error while getting split test notification",t),s.onError&&s.onError(t)}else if(e){var n=decodeURIComponent(e.messagetext),r=e.messagecontent,i=e.phash,o={settings:s,phash:i};m.info("Received text for split test notification:",n),a(n,r,function(){_.setPhash(o.settings,o.phash),o=null,m.info("User accepted notification")})}else m.info("No result received")},function(e){m.error("Error while getting split test notification"),s.onError&&s.onError(e)}))}else m.error("method signature is incorrect")},displayInterstitial:function(d,s,p,f,g,h,e){function t(e,t){if(m.debug("Received interstitial",e),e&&e.message){var a=e.message.phash,u=JSON.parse(decodeURIComponent(e.message.messagecontent)),n=u.subject.replace(/\s+/g,"-").toLowerCase(),r=decodeURIComponent(u.html),i={settings:d,phash:a},c=function(){_.setPhash(i.settings,i.phash),m.info("Pushed new phash.",i.phash),i=null},l={};b.forEachInObject(p,function(o,s){l[o]=function(e,t){var n=o.split(/\s+/),r=b.capitalize(n[0]),i=n[1];y.registerEvent(d,r,{id:i},null,a),(t=t||{}).pushPhash=c,t.meta=u,s(e,t)}});var o=v.showEmptyModal(["ol-interstitial",n],r,l,function(){(y.registerEvent(d,"Close",{},null,a),f)&&f({meta:u})});if(g)g({phash:a,modal:o});w.trace(d,"notification.interstitial.display","info","Ready to mark as displayed if cached.",{cached:t}),t&&(v.clearStoredValue("OL-Content-"+s),S.markInterstitialAsDisplayed(d,e.message))}else h&&h()}var n=v.getStoredValue("OL-Content-"+s);if(n)t(JSON.parse(n),!0);else{var r={placement:s};if(e&&void 0!==e.displayGroup){var i=isNaN(parseInt(e.displayGroup,10))?void 0:parseInt(e.displayGroup,10);r.displayGroup=i}var o=d.server.contentEndpoint+"/"+d.data.app_key+"/"+d.data.tracking_id+"/interstitial/v2/fetch?preload=false";v.http.post(o,r,!0,b.nodeCallbackForTwo(t,function(e){m.error("Error getting interstitial",e),d.onError&&d.onError(e)}))}},showSimpleModal:function(e,t,n,r,i){v.showSimpleModal(e,t,n,r,i)}};t.exports={receivedPushNotification:S.receivedPushNotification,splitTestNotification:S.splitTestNotification,showSimpleModal:S.showSimpleModal,displayInterstitial:S.displayInterstitial}},{"../platform":20,"../utils":36,"./event":23,"./logging":24,"./session":30,"./tracing":32}],26:[function(e,t,n){var s=e("./push"),a=e("./notification"),u=e("./logging"),c=e("./event"),l=e("../utils"),d=e("./tracing"),p={"notification-prompt-no":function(e,t){u.debug("user declined soft opt-in"),t&&t("notification-prompt-no")},"notification-prompt-yes":function(t,n){if(t.permissionUrls.notificationYes){var e=l.updateUrlParameter(t.permissionUrls.notificationYes,"_oltid",t.data.tracking_id);t.data.sid&&(e=l.updateUrlParameter(e,"_olsid",t.data.sid)),void 0!==t.tracingEnabled&&(e=l.updateUrlParameter(e,"tracingEnabled",t.tracingEnabled)),d.trace(t,"permission.soft-opt-in.pop-up","info","Displaying pop-up to finalise web push subscription.",{url:e,popupOptions:t.popupOptions});var r=window.open(e,"",t.popupOptions),i=function(){null!==r&&r.closed?(d.trace(t,"permission.soft-opt-in.pop-up","info","Pop-up has been closed."),s.isSubscribedToPush(t,function(e){e?d.trace(t,"permission.soft-opt-in.subscribed","info","Subscribed to web push."):d.trace(t,"permission.soft-opt-in.subscribed","info","Browser push subscription unsuccessful."),n(e?"subscribed":"notsubscribed")})):setTimeout(i,2e3)};setTimeout(i,2e3)}else d.trace(t,"permission.soft-opt-in.subscribe","info","Finalising subscription on current domain."),s.subscribeToPush(t,function(e){var t=void 0!==e&&"Delivery Details updated"===e.response?"subscribed":"notsubscribed";n(t)})},"notification-settings-yes":function(e,t){-1!==navigator.userAgent.indexOf("Chrome")?(d.trace(e,"permission.soft-opt-in.settings","info","Displaying settings info in another tab.",{url:e.permissionSettingsUrls.chrome}),window.open(e.permissionSettingsUrls.chrome).onbeforeunload=function(){t()}):setTimeout(function(){d.trace(e,"permission.soft-opt-in.settings","info","Displaying settings info in another tab.",{url:e.permissionSettingsUrls.firefox}),window.open(e.permissionSettingsUrls.firefox).onbeforeunload=function(){t()}},100)}},f="Notification Settings",g={_processPermissionAction:function(n,r,e,i,o){return function(){var e=i.replace("/","");u.info("Permission action "+e+" clicked"),d.trace(n,"permission.soft-opt-in.click","info","Button clicked in interstitial",{action:e}),c.registerEvent(n,e,{},null,r.phash);var t=p[e];return t?(u.debug("Function found for action"),t(n,o)):o&&o(),r.modal.close(),!1}},_onLoaded:function(e,t,n){c.registerEvent(e,"notification-prompt-displayed",{},null,t.phash);for(var r=/otherlevels:\/\/(.*)/i,i=document.links,o=i.length,s=0;s<o;s++){var a=r.exec(i[s].href);a&&(u.debug("Found otherlevels scheme link in document with action"+a[1]),i[s].onclick=g._processPermissionAction(e,t,i[s],a[1],n))}},_askForNotificationPermission:function(r,i,o){u.debug("About to check for notification permission"),s.isPushSupported(r,function(e){if(!e)return d.trace(r,"permission.ask","info","Web push is not supported. Doing nothing."),u.info("Push is not supported, take no action"),o("push not supported");s.getNotificationPermission(r,function(t){var n=function(e){g._onLoaded(r,e,o)};s.isSubscribedToPush(r,function(e){"default"===t||"granted"===t&&!e||"granted"===t&&!l.isHTTPS()?(u.info("Prompting for Interstitial with placement ",i),d.trace(r,"permission.soft-opt-in","info","Permissions are: "+t+" isSubscribed: "+e+". Displaying soft opt-in interstitial"),a.displayInterstitial(r,i,{},function(){},n,function(){d.trace(r,"permission.soft-opt-in.notfound","error","No matching notification permission interstitial found for placement",{placement:i});var e='No matching notification permission interstitials ("'+i+'" placement) found for this tracking id - check filters on interstitials';u.debug(e),o(e)})):"denied"===t?(u.info("Prompting for Interstitial with placement Notification Settings"),d.trace(r,"permission.soft-opt-in","info","Browser notification permissions have been denied. Displaying setting configuration interstitial"),a.displayInterstitial(r,f,{},function(){},n,function(){d.trace(r,"permission.soft-opt-in.notfound","error","No matching notification settings interstitial found for placement",{placement:i});var e='No matching notification settings interstitials ("'+f+'" placement)  found for this tracking id - check filters on interstitials.';u.debug(e),o(e)})):(d.trace(r,"permission.soft-opt-in","info","Permissions have already been granted before."),p["notification-prompt-yes"](r,o))})})})},askForPermission:function(e,t,n,r){var i=l.isFunction(r)?r:l.isFunction(n)?n:void 0,o=n&&!l.isFunction(n)&&n.placement?n.placement:"Notification Prompt";if("notification"===t)return d.trace(e,"permission.ask","info",'Asking for "notification" permissions for web push with soft opt-in',{placement:o}),g._askForNotificationPermission(e,o,i);u.error("invalid permission"),r("invalid permission")}};t.exports={askForPermission:g.askForPermission}},{"../utils":36,"./event":23,"./logging":24,"./notification":25,"./push":28,"./tracing":32}],27:[function(i,e,t){var p=i("./logging"),f=i("../platform"),d=i("../utils"),g=i("../utils/facade"),h=i("./event"),r=i("./session"),m=i("./push"),v=i("./tracing"),b="Notification Prompt",o=["App Open","Feedback","Location Prompt","Location Settings","Manual Location Settings","Manual Notification Settings",b,"Notification Settings","Placement 1","Placement 2","Placement 3","Placement 4","Placement 5","Placement 6","Placement 7","Placement 8","Placement 9","Placement A","Placement B","Placement C","Placement D","Placement E","Placement F","Push Open","Store Launch"],y={_setupInterstitialEventHandlers:function(a,u,c,e){var t={},n={settings:a,phash:c},l=function(){r.setPhash(n.settings,n.phash),p.info("Pushed new phash.",n.phash),n=null};return d.forEachInObject(e,function(o,s){t[o]=function(e,t){var n=o.split(/\s+/),r=d.capitalize(n[0]),i=n[1];h.registerEvent(a,r,{id:i},null,c),(t=t||{}).pushPhash=l,t.meta=u,s(e,t)}}),t},_makePreloadHttpRequest:function(e,t,n,r,i){var o={placement:t};if(n&&n.displayGroup){var s=isNaN(parseInt(n.displayGroup,10))?void 0:parseInt(n.displayGroup,10);o.displayGroup=s}var a=e.server.contentEndpoint+"/"+e.data.app_key+"/"+e.data.tracking_id+"/interstitial/v2/fetch?preload=true";f.http.post(a,o,!0,d.nodeCallbackForTwo(r,i))},markInterstitialAsDisplayed:function(t,e){var n={phash:e.phash,templateId:e.templateid,splitId:e.splitid},r=t.server.contentEndpoint+"/"+t.data.app_key+"/"+t.data.tracking_id+"/interstitial/v2/mark-displayed";f.http.post(r,n,!0,d.nodeCallbackForTwo(function(){p.debug("Successfully marked interstitial as displayed.")},function(e){p.error("Error marking interstitial as displayed.",e),t.onError&&t.onError(e)}))},_showCachedInterstitial:function(e,t,n,r,i){var o=f.getStoredValue("OL-Content-"+t);if(o){var s=JSON.parse(o),a=s.message.phash,u=JSON.parse(decodeURIComponent(s.message.messagecontent)),c=u.subject.replace(/\s+/g,"-").toLowerCase(),l=decodeURIComponent(u.html),d=y._setupInterstitialEventHandlers(e,u,a,i),p=f.showEmptyModal(["ol-interstitial",c],l,d,function(){(h.registerEvent(e,"Close",{},null,a),n)&&n({meta:u})});if(r)r({phash:a,modal:p});f.clearStoredValue("OL-Content-"+t),y.markInterstitialAsDisplayed(e,s.message)}},_preloadInterstitial:function(o,s,a,u,c,l,n){v.trace(o,"preload.preloadInterstitial","info","Beginning interstitial preload for placement.",{placement:s});var d=s===b;function r(e){if(p.debug("Received preload interstitial.",e),v.trace(o,"preload.preloadInterstitial","info","Received preload interstitial.",{message:e.message}),e&&e.message){var t={message:e.message};f.setStoredValue("OL-Content-"+s,JSON.stringify(t));var n=d?g.getAskForPermissionFacade(o,s):function(){y._showCachedInterstitial(o,s,u,c,a)},r=JSON.parse(decodeURIComponent(e.message.messagecontent)),i=decodeURIComponent(r.html);f.applyModalTrigger(o,i,n)}else l&&l()}function i(e){p.error("Error getting interstitial.",e),o.onError&&o.onError(e)}var e=f.getStoredValue("OL-Content-"+s);e?(v.trace(o,"preload.preloadInterstitial","info","No need to preload. Cached interstitial content found."),r(JSON.parse(e))):d?m.isPushSupported(o,function(e){e&&m.getNotificationPermission(o,function(t){v.trace(o,"preload.preloadInterstitial","info","Checking web push permissions before soft opt-in preload: permission = "+t),m.isSubscribedToPush(o,function(e){e||"denied"===t?v.trace(o,"preload.preloadInterstitial","info","Not executing soft opt-in preload: isSubscribed = "+e+"; permission = "+t):(v.trace(o,"preload.preloadInterstitial","info","Executing soft opt-in HTTP call: isSubscribed = "+e+"; permission = "+t),y._makePreloadHttpRequest(o,s,n,r,i))})})}):(v.trace(o,"preload.preloadInterstitial","info","Executing standard interstitial HTTP call."),y._makePreloadHttpRequest(o,s,n,r,i))},preloadInterstitials:function(e){var t=y._getPlacements(e);if(t){var n=t.indexOf(b);-1<n&&(t=t.splice(n,1).concat(t));var r=t.splice("2");for(var i in 0<r.length&&p.warn('The number of valid placements in "preloadContent" exceeds the preload limit of 2. The following placements will not be preloaded: '+r.join(", ")),t)y._preloadInterstitial(e,t[i])}},clearCachedInterstitials:function(e,t){v.trace(e,"preload.clearCachedInterstitials","info","Clearing cached interstitials.");for(var n=0;n<o.length;n++)f.clearStoredValue("OL-Content-"+o[n]);t&&t()},_getPlacements:function(e){var n=i("underscore"),r=[],t=!0===e.preloadContent?[b]:n.isArray(e.preloadContent)?n.filter(e.preloadContent,function(e){var t=n.contains(o,e);return t||r.push(e),t}):null;return 0<r.length&&p.warn('Invalid "preloadContent" placement(s): '+r.join(", ")),t},_hasCachedInterstitial:function(e,t){var n=f.getStoredValue("OL-Content-"+t);return v.trace(e,"preload.hasCachedInterstitial","info","Cached interstitial "+(n?"exists":"does not exist")+" for placement: "+t),null!==n},hasCachedInterstitials:function(e){var t=y._getPlacements(e);for(var n in t)if(!y._hasCachedInterstitial(e,t[n]))return!1;return null!==t&&0<t.length}};e.exports={hasCachedInterstitial:y._hasCachedInterstitial,hasCachedInterstitials:y.hasCachedInterstitials,clearCachedInterstitials:y.clearCachedInterstitials,preloadInterstitial:y._preloadInterstitial,preloadInterstitials:y.preloadInterstitials,markInterstitialAsDisplayed:y.markInterstitialAsDisplayed}},{"../platform":20,"../utils":36,"../utils/facade":35,"./event":23,"./logging":24,"./push":28,"./session":30,"./tracing":32,underscore:2}],28:[function(e,t,n){var r,i,p=e("./logging"),c=e("../platform"),f=e("../utils"),g=f.Promise;function h(n){return c.push.isHttpWebPushSupported().then(function(e){if(!n.crossOriginReceiverUrl||e)return c.push;if(!r){var t=n.crossOriginReceiverUrl;void 0!==n.tracingEnabled&&(t=f.updateUrlParameter(t,"tracingEnabled",n.tracingEnabled)),n.trace("push.configure","info","Web push subscription is managed on another domain. Loading remote page to communicate to in a hidden iframe.",t),r=c.iframeProxy.proxySenderObject(c.push,t,"push")}return r})}function l(e,t,i,o){return new g(function(n,r){c.http[e](t,i,o,function(e,t){e?r(e):n(t)})})}function m(e,t,n){return l("delete",e,t,n)}var o={isPushSupported:function(t,n){n=n||function(){},h(t).then(function(e){return e.isSupported()}).then(n,function(e){t.onError(e),n()})},subscribeToPush:function(a,t){t=t||function(){},h(a).then(function(s){a.trace("push.subscribe","info","Subscribing to push"),s.subscribe(a).then(function(t){var e,n,r,i=a.server.deliverabilityEndpoint+"/deliverability/appkey/"+a.data.app_key+"/trackingid/"+a.data.tracking_id+"/messagetype/browserpush",o={messageType:"browserpush",deliveryDetails:t};return a.trace("push.delivery-details","info","Sending delivery details to the API",{url:i,payload:o}),(e=i,n=o,r=!0,l("put",e,n,r)).then(function(e){return a.trace("push.delivery-details","info","Delivery details updated with the API",{response:e}),s.saveSubscriptionDetails(a,t).then(function(){return e})})}).then(t,function(e){a.onError&&a.onError(e),a.trace("push.subscribe","error","Error occurred while subscribing to push",{error:e.message||e}),t()})})},unsubscribeFromPush:function(o,t){t=t||function(){},h(o).then(function(i){return o.trace("push.unsubscribe","info","Unsubscribing from push"),g.all([i.requiresDeliverabilityDelete(),i.unsubscribe(o)]).then(function(e){var t=e[0],n=e[1];if(t){if(n){var r=o.server.deliverabilityEndpoint+"/deliverability/appkey/"+o.data.app_key+"/trackingid/"+o.data.tracking_id+"/messagetype/browserpush";return o.trace("push.unsubscribe.remove-details","info","Removing delivery details for the tracking ID"),m(r,null,!0).then(function(){return i.removeSubscriptionDetails(o)})}o.trace("push.unsubscribe.no-subscription-endpoint","info","Unsubscribe did not return a subscription endpoint")}else o.trace("push.unsubscribe.remove-details","info","Not removing delivery details because it is done by the browser on this platform")}).then(t,function(e){o.onError&&o.onError(e),o.trace("push.unsubscribe","error","Error occurred while unsubscribing from push",{error:e.message}),t()})})},isSubscribedToPush:function(t,n){n=n||function(){},h(t).then(function(e){e.isSubscribed(t).then(function(e){t.trace("push.is-subscribed","info","Checked if subscribed to push: "+e,{subscribed:e}),n(e)},function(e){t.trace("push.is-subscribed","error","Error occurred while checking if subscribed to push",{error:e.message}),t.onError(e),n()})})},getNotificationPermission:function(t,n){n=n||function(){},h(t).then(function(e){e.getNotificationPermission(t).then(function(e){t.trace("push.permissions","info","Got notification permissions",e),n(e)},function(e){t.trace("push.permissions","error","Error while getting notification permissions",{error:e.message||e,stack:e.stack}),t.onError&&t.onError(e),n()})})},getLastNotificationPhash:function(n,t){var r;t=t||function(){},h(n).then(function(e){return(r=e).isSupported()}).then(function(e){if(e)return r.getLastPushMessage()}).then(function(e){if(e){var t;p.info("Found last browser push message. Extracting phash."),p.debug("Last browser push message is ",e);try{t=JSON.parse(e)}catch(e){p.warn("Could not parse last push message: ",e.stack)}if(t&&t.phash)return n.trace("push.notification-phash","info","Found phash from the last web push notification",t.phash),p.info("Extracted phash: "+t.phash),t.phash}}).then(t,function(e){n.onError&&e&&n.onError(e),t()})},setUpRemoteReceiver:function(){i||(i=c.iframeProxy.proxyReceiverObject(c.push,"push"))},updateTrackingId:function(r,e,i,t){t=t||function(){};var n,o,s,a=r.server.deliverabilityEndpoint+"/deliverability/appkey/"+r.data.app_key+"/trackingid/"+e+"/messagetype/browserpush/renameTrackingId?platform="+c.getBrowserName(),u={newTrackingId:i};r.trace("push.delivery-details","info","Updating tracking ID for delivery details",{old:e,new:i}),g.all([h(r),(n=a,o=u,s=!0,l("post",n,o,s))]).then(function(e){var t=e[0],n=e[1];return r.trace("push.delivery-details","info","Updated tracking ID for delivery details",{response:n}),t.saveRecipientDetails(r.data.app_key,i)}).then(t,function(e){r.trace("push.delivery-details","error","Could not save recipient details",{error:e.message}),r.onError&&r.onError(e),t()})},updateDeliverabilityStatus:function(l,e){var d,t=e||function(){};h(l).then(function(e){return(d=e).isSupported()}).then(function(e){if(e)return g.all([d.getNotificationPermission(l),d.isSubscribed(l),d.getSubscriptionDetails(l)]).then(function(e){var t=e[0],n=e[1],r=e[2],i=!!r,o="granted"!==t,s="granted"===t&&!n,a=l.multipleSubdomains,u=f.getHostname()===l.primarySubdomain,c=l.isUsingHttpSolution;if(i&&(o||s)&&(!a||a&&u||a&&c))return l.trace("push.update-deliverability-status","info","Tracking ID no longer deliverable - requesting deliverability deletion.",{subscription:r,permission:t,isSubscribed:n,subscriptionIsPresent:i,permissionsAreNotGranted:o,permissionsAreGrantedButNotSubscribed:s,isMultiSubdomain:a,isPrimarySubdomain:u,isUsingHttpSolution:c}),m(l.server.deliverabilityEndpoint+"/deliverability/appkey/"+l.data.app_key+"/trackingid/"+l.data.tracking_id+"/messagetype/browserpush/subscription",r,!0).then(d.removeSubscriptionDetails).then(function(){p.info("Set as undeliverable: Tracking ID: "+l.data.tracking_id+" subscription: ",r),l.trace("push.update-deliverability-status","info","Has been set as undeliverable",{trackingId:l.data.tracking_id,subscription:r,triggerConditions:{subscriptionIsPresent:i,permissionsAreNotGranted:o,permissionsAreGrantedButNotSubscribed:s}})})})}).then(t,function(e){l.onError&&l.onError(e),t()})},readServiceWorkerTraceEvents:function(e){return h(e).then(function(e){return e.readTraceEvents()})},getServiceWorkerConfig:function(e){return h(e).then(function(e){return e.getServiceWorkerConfig()})}};t.exports={isPushSupported:o.isPushSupported,subscribeToPush:o.subscribeToPush,unsubscribeFromPush:o.unsubscribeFromPush,isSubscribedToPush:o.isSubscribedToPush,getNotificationPermission:o.getNotificationPermission,getLastNotificationPhash:o.getLastNotificationPhash,setUpRemoteReceiver:o.setUpRemoteReceiver,updateTrackingId:o.updateTrackingId,updateDeliverabilityStatus:o.updateDeliverabilityStatus,readServiceWorkerTraceEvents:o.readServiceWorkerTraceEvents,getServiceWorkerConfig:o.getServiceWorkerConfig}},{"../platform":20,"../utils":36,"./logging":24}],29:[function(e,t,n){var l=e("./logging"),d=e("../utils"),p=e("../platform"),f=e("./event"),g={_messages:[],_meta:{total:0,unread:0},_onMessagesUpdatedCallback:void 0,_maxDelay:Math.pow(2,31)-1,_lastDisplayGroupUsed:void 0,_checkDisplayGroup:function(e,t){t!==g._lastDisplayGroupUsed&&(g._lastDisplayGroupUsed=t,0<g._messages.length&&g.clear(e))},_messagesSorter:function(e,t){return e.delivered_at>t.delivered_at?-1:e.delivered_at<t.delivered_at?1:e.id>t.id?-1:1},_syncServer:function(e,t,r){var i=e.server.rimsEndpoint+"/"+e.data.app_key+"/"+e.data.tracking_id+"/rich/mailbox";t&&void 0!==t.displayGroup&&!isNaN(parseInt(t.displayGroup,10))?(i+="?displayGroup="+t.displayGroup,i+="&"):i+="?",i+="stateHash=";var o="";!function n(){p.http.get(i+o,function(e,t){e||!t?r(e||new Error("response is empty")):t.synchronisation_complete?r():(o=t.state_hash,setTimeout(n,0))})}()},_removeExpired:function(){for(var e=[],t=[],n=0,r=(new Date).getTime()/1e3,i=0;i<g._messages.length;i++){var o=g._messages[i];void 0!==o.end&&o.end<=r?(t.push(o),o.read||n++):e.push(o)}if(g._messages=e,g._meta.total-=t.length,g._meta.unread-=n,g._meta.total<g._messages.length){g._meta.total=g._messages.length;var s=0;for(i=0;i<g._messages.length;i++)s+=g._messages[i].read?0:1;g._meta.unread=s}l.debug("RIMS expired ",t.length+" messages."),0<t.length&&g._onMessagesUpdatedCallback&&g._onMessagesUpdatedCallback(g._messages,[],[],t,g._meta),g.scheduleExpirationCheck()},_expirationCheckTimeout:void 0,scheduleExpirationCheck:function(){var e;void 0!==g._expirationCheckTimeout&&(clearTimeout(g._expirationCheckTimeout),g._expirationCheckTimeout=void 0);for(var t=0;t<g._messages.length;t++){var n=g._messages[t];void 0!==n.end&&void 0===e&&(e=n.end),void 0!==n.end&&n.end<e&&(e=n.end)}if(void 0!==e){var r=e-(new Date).getTime()/1e3;r=r<0?0:r,g._meta.total<g._messages.length&&(r=0);var i=1e3*r;i=i>g._maxDelay?g._maxDelay:i,l.debug("RIMS expiration check in "+i/1e3+" sec"),g._expirationCheckTimeout=setTimeout(g._removeExpired,i)}},onMessagesUpdated:function(e,t){g._onMessagesUpdatedCallback=t},getNewMessages:function(n,e,r){var t=n.server.rimsEndpoint+"/"+n.data.app_key+"/"+n.data.tracking_id+"/rich/mailbox/messages",i=[];e&&void 0!==e.displayGroup&&!isNaN(parseInt(e.displayGroup,10))?(i.push(["displayGroup",e.displayGroup]),g._checkDisplayGroup(n,e.displayGroup)):g._checkDisplayGroup(n),0===g._messages.length?e&&e.limit&&i.push(["limit",e.limit]):i.push(["newerThan",g._messages[0].delivered_at]);for(var o=0;o<i.length;o++){var s=i[o];t+=(0===o?"?":"&")+s[0]+"="+s[1]}function a(e){if(e&&void 0!==e.items&&e.meta){if(l.info("Received "+e.items.length+" messages in rich inbox"),e.items){e.items.sort(g._messagesSorter);for(var t=0;t<e.items.length;t++)e.items[t].content&&(e.items[t].content=decodeURIComponent(e.items[t].content));g._messages=e.items.concat(g._messages)}g._meta={total:e.meta.total,unread:e.meta.unread},r&&r(e.items,g._meta),g._onMessagesUpdatedCallback&&g._onMessagesUpdatedCallback(g._messages,e.items,[],[],g._meta),g.scheduleExpirationCheck()}else n.onError&&n.onError(new Error("Malformed response from the Rich Inbox endpoint"))}function u(e){l.error("Error getting Rich Inbox messages",e),n.onError&&n.onError(e),g.scheduleExpirationCheck()}g._syncServer(n,e,function(e){e?u(e):p.http.get(t,d.nodeCallbackForTwo(a,u))})},getMoreMessages:function(n,e,r){if(0===g._messages.length)return g.getNewMessages(n,e,r);var t=n.server.rimsEndpoint+"/"+n.data.app_key+"/"+n.data.tracking_id+"/rich/mailbox/messages",i=[];e&&void 0!==e.displayGroup?(i.push(["displayGroup",e.displayGroup]),g._checkDisplayGroup(n,e.displayGroup)):g._checkDisplayGroup(n),0<g._messages.length&&i.push(["olderThan",g._messages[g._messages.length-1].delivered_at]);for(var o=0;o<i.length;o++){var s=i[o];t+=(0===o?"?":"&")+s[0]+"="+s[1]}p.http.get(t,d.nodeCallbackForTwo(function(e){if(e&&void 0!==e.items&&e.meta){if(l.info("Received "+e.items.length+" messages in rich inbox"),e.items){e.items.sort(g._messagesSorter);for(var t=0;t<e.items.length;t++)e.items[t].content&&(e.items[t].content=decodeURIComponent(e.items[t].content));g._messages=g._messages.concat(e.items)}g._meta={total:e.meta.total,unread:e.meta.unread},r&&r(e.items,g._meta),g._onMessagesUpdatedCallback&&g._onMessagesUpdatedCallback(g._messages,e.items,[],[],g._meta),g.scheduleExpirationCheck()}else n.onError&&n.onError(new Error("Malformed response from the Rich Inbox endpoint"))},function(e){l.error("Error getting Rich Inbox messages",e),n.onError&&n.onError(e),g.scheduleExpirationCheck()}))},getMessages:function(e,t){t&&t(g._messages,g._meta)},markAsRead:function(a,u,c){var e=a.server.rimsEndpoint+"/"+a.data.app_key+"/"+a.data.tracking_id+"/rich/mailbox/messages/"+u;p.http.put(e,{read:!0},!0,d.nodeCallbackForTwo(function(){for(var e,t=!1,n=0;n<g._messages.length;n++){var r=g._messages[n];if(r.id===u){t=1===r.read,r.read=1,e=r,t||g._meta.unread--;break}}var i=t?"Re-Read":"Read",o=t?"Rich Message "+u+" Re-Read":"Rich Message "+u+" Opened";if(f.registerEvent(a,i,o,null,e?e.phash:void 0),l.info("Marked message "+u+" as "+i+"."),c&&c(e),g._onMessagesUpdatedCallback){var s=[];e&&s.push(e),g._onMessagesUpdatedCallback(g._messages,[],s,[],g._meta)}g.scheduleExpirationCheck()},function(e){l.error("Error marking Rich Inbox message as read",e),a.onError&&a.onError(e),g.scheduleExpirationCheck()}))},markAsDeleted:function(i,o,s){var e=i.server.rimsEndpoint+"/"+i.data.app_key+"/"+i.data.tracking_id+"/rich/mailbox/messages/"+o;p.http.put(e,{deleted:!0},!0,d.nodeCallbackForTwo(function(){for(var e,t=0;t<g._messages.length;t++){var n=g._messages[t];if(n.id===o){e=n,g._meta.total--,n.read||g._meta.unread--;break}}if(e&&(g._messages=d.arrayRemove(g._messages,e)),f.registerEvent(i,"Delete","Rich Message "+o+" Deleted",null,e?e.phash:void 0),l.info("Marked message "+o+" as deleted."),s&&s(e),g._onMessagesUpdatedCallback){var r=[];e&&r.push(e),g._onMessagesUpdatedCallback(g._messages,[],[],r,g._meta)}g.scheduleExpirationCheck()},function(e){l.error("Error marking Rich Inbox message as deleted",e),i.onError&&i.onError(e),g.scheduleExpirationCheck()}))},setMessages:function(e,t){g._messages=t||[];for(var n=0,r=0;r<g._messages.length;r++)g._messages[r].read||n++;g._meta={total:g._messages.length,unread:n}},clear:function(e){l.logLevel=e.logLevel;var t=g._messages;g._messages=[],g._meta={total:0,unread:0},g._onMessagesUpdatedCallback&&g._onMessagesUpdatedCallback(g._messages,[],[],t,g._meta),l.debug("Cleared RIMS messages")},_clearLastDisplayGroupUsed:function(){g._lastDisplayGroupUsed=void 0}};t.exports={getNewMessages:g.getNewMessages,getMoreMessages:g.getMoreMessages,getMessages:g.getMessages,onMessagesUpdated:g.onMessagesUpdated,setMessages:g.setMessages,markAsRead:g.markAsRead,markAsDeleted:g.markAsDeleted,clear:g.clear,_clearLastDisplayGroupUsed:g._clearLastDisplayGroupUsed}},{"../platform":20,"../utils":36,"./event":23,"./logging":24}],30:[function(e,t,n){var g=e("./logging"),h=e("../platform"),m=e("../utils"),v=e("./push"),b=e("./tracing"),y={startSession:function(t,n){v.getLastNotificationPhash(t,function(e){g.debug("Checking for a phash",e),e&&g.debug("phash "+e+" found"),y.startSessionWithPhash(t,e,n)})},startSessionWithPhash:function(r,e,t){b.trace(r,"session.startSessionWithPhash","info","Push phash value is "+e,e),y._sesionRefreshInterval&&(clearInterval(y._sesionRefreshInterval),y._sesionRefreshInterval=null);var n,i,o,s=h.getStoredValue("OL_Session_Id"),a=s?h.getStoredValue("OL_Phash"):null;b.trace(r,"session.startSessionWithPhash","info","Stored phash value.",a);var u=h.getOLParametersFromQueryString();n=u.sessionId,i=u.trackingId,o=u.phash,i||o||(o=h.getPhashFromHashFragment(r.phashTag)),b.trace(r,"session.startSessionWithPhash","info","URL phash value is "+o,o),o=o||e,n&&s!==n&&(s=n,h.setStoredValue("OL_Session_Id",s));var c=!(s&&(!o||a===o));if(r.data.sid=s&&!1===c?s:m.generateUUID(),r.data.session_length=0,r.data.average_session_length=0,r.data.phash=o||a,c&&f(r.data.sid,r.data.phash),i&&h.getStoredValue("OL_Tracking_ID")!==i){var l=m.getLongTermExpiry();r.data.prev_tracking_id=r.data.tracking_id,h.setStoredValue("OL_Prev_Tracking_ID",r.data.prev_tracking_id,l),r.data.tracking_id=i,h.setStoredValue("OL_Tracking_ID",r.data.tracking_id,l)}function d(){var e=h.getStoredValue("OL_Session_Id"),t=h.getStoredValue("OL_Phash");y._sesionRefreshInterval&&null===e&&0<r.sessionExpirationSeconds?(clearInterval(y._sesionRefreshInterval),y._sesionRefreshInterval=null,y.startSession(r)):f(e,t)}function p(){!y._sesionRefreshInterval&&0<r.sessionExpirationSeconds&&(y._sesionRefreshInterval=setInterval(d,1e4))}function f(e,t){var n=new Date((new Date).getTime()+1e3*r.sessionExpirationSeconds);g.debug("Setting session expiration on: "+n),0<r.sessionExpirationSeconds?(null!==e&&(r.data.sid=e),b.trace(r,"session.storePhash","info","Storing phash.",t),h.setStoredValue("OL_Session_Id",r.data.sid,n),h.setStoredValue("OL_Phash",t,n)):(b.trace(r,"session.storePhash","info","Clearing session ID and phash."),h.clearStoredValue("OL_Session_Id"),h.clearStoredValue("OL_Phash"))}r.sessionStart=(new Date).getTime(),d(),v.updateDeliverabilityStatus(r),g.info("startSession",r.data.sid),c?(b.trace(r,"session.start","info","Using new generated session.",r.data.sid),g.debug("new session id: "+r.data.sid+" old session id: "+s+" new tracking id: "+r.data.tracking_id+" old tracking id: "+r.data.prev_tracking_id+" new phash: "+r.data.phash+" old phash: "+a),h.http.post(r.server.apiEndpoint+"/session",r.data,!1,m.nodeCallbackForTwo(function(e){b.trace(r,"session.start","info","Session updated with the API.",{endpoint:r.server.apiEndpoint+"/session",response:e}),p(),t&&t(e,c)},function(e){b.trace(r,"session.error","error","Error while sending a session start request to the API",e),r.onError&&r.onError(e)}))):(b.trace(r,"session.continue","info","Reusing stored session",r.data.sid),t&&setTimeout(function(){p(),t(null,c)},0)),b.trace(r,"session.ready","info","Phash for session is "+r.data.phash,r.data.phash)},getSessionId:function(e){return e.data.sid},endSession:function(e,t){if(!e.data.sid)return b.trace(e,"session.end","info","endSession called, but no active session found. Ignoring."),void g.info("endSession ignored as no active session");g.info("endSession",e.data.sid),b.trace(e,"session.end","info","Ending session",e.data.sid),e.data.session_length=(new Date).getTime()-(e.sessionStart||0);var n=h.getStoredValue("OL_Session_Count"),r=h.getStoredValue("OL_Total_Session_Length");n&&r?(n=parseInt(n)+1,r=parseInt(r)+e.data.session_length,e.data.average_session_length=Math.ceil(r/n),h.setStoredValue("OL_Session_Count",n,m.getLongTermExpiry()),h.setStoredValue("OL_Total_Session_Length",r,m.getLongTermExpiry())):(e.data.average_session_length=e.data.session_length,h.setStoredValue("OL_Session_Count",1,m.getLongTermExpiry()),h.setStoredValue("OL_Total_Session_Length",e.data.session_length,m.getLongTermExpiry())),h.http.post(e.server.apiEndpoint+"/session/end",e.data,!1,m.nodeCallbackForTwo(t,e.onError)),delete e.data.sid,delete e.data.phash,delete e.data.prev_tracking_id,h.setStoredValue("OL_Prev_Tracking_ID",null),clearInterval(y._sesionRefreshInterval),h.setStoredValue("OL_Session_Id",null),h.setStoredValue("OL_Phash",null)},setTrackingId:function(e,t,n){g.info("setTrackingId",t),e.data.prev_tracking_id=e.data.tracking_id,h.setStoredValue("OL_Prev_Tracking_ID",e.data.prev_tracking_id,m.getLongTermExpiry()),e.data.tracking_id=t,h.setStoredValue("OL_Tracking_ID",e.data.tracking_id,m.getLongTermExpiry()),b.trace(e,"session.set-trackingid","info","Set tracking ID.",{old:e.data.prev_tracking_id,new:e.data.tracking_id}),h.http.post(e.server.apiEndpoint+"/session/tracking_id",e.data,!1,m.nodeCallbackForTwo(n,e.onError))},getTrackingId:function(e){return e.data.tracking_id},setPhash:function(e,t){e.data.phash=t;var n=new Date((new Date).getTime()+1e3*e.sessionExpirationSeconds);b.trace(e,"session.set-phash","info","Setting phash.",e.data.phash),h.setStoredValue("OL_Phash",e.data.phash,n)},applySessionExpiryListeners:function(e,t,n){h.applySessionExpiryListeners(e,t,n)}};t.exports={startSession:y.startSession,getSessionId:y.getSessionId,endSession:y.endSession,setTrackingId:y.setTrackingId,getTrackingId:y.getTrackingId,setPhash:y.setPhash,applySessionExpiryListeners:y.applySessionExpiryListeners}},{"../platform":20,"../utils":36,"./logging":24,"./push":28,"./tracing":32}],31:[function(e,t,n){var s=e("./logging"),i=e("../platform"),a=e("../utils"),o=e("../utils/sequeue"),u={batchQueue:new o(i.http),queues:{},addToQueue:function(e,t,n,r){void 0===u.queues[e]&&(u.queues[e]=new o(i.http)),u.queues[e].add(t,n,r)},setTag:function(e,t,n,r,i){s.info("setTag",t,n,r);var o={trackingid:e.data.tracking_id,appkey:e.data.app_key,name:t,type:r,value:n};u.addToQueue(t,"post",[e.server.tagsEndpoint+"/",o,!0],a.nodeCallbackForTwo(i,e.onError))},batchSetTag:function(e,t,n){s.info("setTags",t);var r={trackingid:e.data.tracking_id,appkey:e.data.app_key,tags:t};u.batchQueue.add("post",[e.server.tagsEndpoint+"/",r,!0],a.nodeCallbackForTwo(n,e.onError))},getTag:function(e,t,n){var r=e.server.tagsEndpoint+"/apps/"+e.data.app_key+"/tracking/"+e.data.tracking_id+"/tag/"+t;u.addToQueue(t,"get",[r],a.nodeCallbackForTwo(n,e.onError))}};t.exports={setTag:u.setTag,getTag:u.getTag,batchSetTag:u.batchSetTag}},{"../platform":20,"../utils":36,"../utils/sequeue":37,"./logging":24}],32:[function(e,t,n){var r=e("../platform/index.js"),o=e("../utils/index.js"),s=e("./logging.js"),i=e("../utils/browserpush.js"),a=e("./push.js"),u=r.push,c=o.Promise,l="OL_WEB_DEVICE_ID";function d(e,t){return e.timestamp-t.timestamp}var p={_lastEventTimestamp:void 0,_traceCache:[],_traceDb:null,_getTraceDB:function(){return!p._traceDb&&i.isIndexedDBSupported()&&(p._traceDb=new i.IndexedDBWrapper("ol-jssdk-trace-events",1,{autoIncrement:!0})),p._traceDb},_addToCache:function(e){var t=p._getTraceDB();return t?t.add(JSON.stringify(e)).then(function(){},function(e){s.error("Could not add trace event to IndexedDB: "+e.message)}):(p._traceCache.push(e),c.resolve())},_getCachedItems:function(){var e=p._getTraceDB();return e?e.getAll().then(function(e){return e.map(function(e){return JSON.parse(e)})}):c.resolve(p._traceCache.concat([]))},_clearCachedItems:function(){var e=p._getTraceDB();return e?e.clear().catch(function(e){s.error("Could not remove trace event from IndexedDB: "+e.message)}):(p._traceCache.splice(0,p._traceCache.length),c.resolve())},_outputTraceEvents:function(e){e.forEach(function(e){var t=new Date(e.timestamp),n="["+e.tag+"] "+t+" : "+e.description;s.trace(n,e.meta)}),0<e.length&&(p._lastEventTimestamp=e[e.length-1].timestamp)},_traceOutputPoller:function(e){p.readCachedTraceEvents(e,{afterTimestamp:p._lastEventTimestamp}).then(function(e){e&&p._outputTraceEvents(e)}),p._tracerEnabled&&setTimeout(function(){p._traceOutputPoller(e)},1e3)},enableTracing:function(e){return p._setUpTracingId().then(function(){p._tracerEnabled=!0,p._lastEventTimestamp=(new Date).getTime(),p._traceOutputPoller(e)},function(e){s.error("Unexpected error while enabling tracing: "+e.message),p._tracerEnabled=!0})},disableTracing:function(){return p._tracerEnabled=!1,u.isSupported().then(function(e){if(e)return u.setTracingDisabled().then(void 0,function(e){s.error("Could not remove tracer enabled key for web push worker: "+e.message)})},function(e){s.error("Could not get web push support information because of error: "+e.message)})},clearTraceEvents:function(){return u.isSupported().then(function(e){return(e?u.clearTraceEvents():c.resolve()).then(p._clearCachedItems,function(e){return s.error("Could not clear trace events from worker: "+e.message),p._clearCachedItems()})},function(e){s.error("Could not get web push support information because of error: "+e.message)})},trace:function(e,t,n,r,i){if(!p._tracerEnabled)return c.resolve();var o,s=(new Date).getTime();try{o=JSON.parse(JSON.stringify(void 0===i?{}:i))}catch(e){o="[could not convert to JSON]"}return p._addToCache({webDeviceId:p._tracingId,timestamp:s,tag:t,severity:n,description:r,meta:o})},readCachedTraceEvents:function(e,t){var i=t&&t.afterTimestamp?t.afterTimestamp:0,n=a.readServiceWorkerTraceEvents(e).then(void 0,function(e){return s.error("Could not read events from push worker: "+e.message),[]}),r=p._getCachedItems().then(void 0,function(e){return s.error("Could not read cached events: "+e.message),[]});return c.all([n,r]).then(function(e){var t,n=e[0],r=e[1].concat(n);return r.sort(d),r=o.filter(r,(t=i,function(e){return e&&e.timestamp&&e.timestamp>t}))})},_setUpTracingId:function(){var t=r.getStoredValue(l);return t||(t=o.generateUUID(),r.setStoredValue(l,t,o.getLongTermExpiry())),p._tracingId=t,o.isHTTPS()||o.isLocalhost()?(s.debug("Setting up tracing for push"),u.isSupported().then(function(e){if(e)return u.setTracingId(t).then(function(){return u.setTracingEnabled().then(void 0,function(e){s.error("Could not set tracer enabled key for web push worker: "+e.message)})},function(e){s.error("Could not set tracer tracingId for web push worker: "+e.message)})},function(e){s.error("Could not get web push support information because of error: "+e.message)})):(s.debug("Not setting up tracing for push because the page is not loaded via HTTPS"),c.resolve())}};t.exports={trace:p.trace,enableTracing:p.enableTracing,disableTracing:p.disableTracing,readCachedTraceEvents:p.readCachedTraceEvents,clearTraceEvents:p.clearTraceEvents}},{"../platform/index.js":20,"../utils/browserpush.js":34,"../utils/index.js":36,"./logging.js":24,"./push.js":28}],33:[function(f,e,t){var g={apiEndpoint:"https://js-api.otherlevels.com/0.8",pushEndpoint:"https://js-ws.otherlevels.com/v1/device",tagsEndpoint:"https://js-tags.otherlevels.com/api",mdnEndpoint:"https://js-mdn.otherlevels.com",contentEndpoint:"https://js-content.otherlevels.com",rimsEndpoint:"https://js-rich.otherlevels.com",deliverabilityEndpoint:"https://js-deliverability-api.otherlevels.com",jsSdkService:"https://safari.otherlevels.com"},h={chrome:"width=450,height=250,location=0,status=0,top=0",default:"width=530,height=270,location=0,status=0,top=0"},n={refreshSettings:function(e,t,n,r){var i=f("underscore"),o=f("../platform"),s=f("../services/logging"),a=f("../utils"),u=f("../services/tracing");n=n||{},r=r||{};var c=h[o.getBrowserName()];c||(c=h.default);var l=a.extend(r.data||{},{app_key:t,app_name:n.appName||"(unknown)",lv:e});a.extend(r,{data:l,server:g,multipleSubdomains:n.multipleSubdomains,primarySubdomain:n.primarySubdomain,dataMigrationSubdomain:n.dataMigrationSubdomain,vapidPublicKey:n.vapidPublicKey,logLevel:n.logLevel||s.LOG_LEVELS.warn,android:{isFirstLaunch:!0,activityCount:0},sessionExpirationSeconds:void 0===n.sessionExpiration?900:n.sessionExpiration,sessionIdleTimeoutEnabled:void 0!==n.sessionIdleTimeoutEnabled&&n.sessionIdleTimeoutEnabled,sessionExpiryCallback:void 0===n.sessionExpiryCallback?function(){}:n.sessionExpiryCallback,sessionRestartedCallback:void 0===n.sessionRestartedCallback?function(){}:n.sessionRestartedCallback,onError:n.onError||void 0,popupOptions:n.popupOptions||c,permissionUrls:{notificationYes:n.notificationYesUrl||void 0},permissionSettingsUrls:{chrome:n.chomeSettingsUrl||"https://support.google.com/chrome/answer/3220216?hl=en",firfox:n.firefoxSettingsUrl||"https://support.mozilla.org/en-US/products/firefox"},crossOriginReceiverUrl:n.crossOriginReceiverUrl,isUsingHttpSolution:void 0!==n.crossOriginReceiverUrl,crossOriginReceiverMode:n.crossOriginReceiverMode,safariWebsitePushId:n.safariWebsitePushId,preloadContent:n.preloadContent,serviceWorkerLocation:n.serviceWorkerLocation||"/ol-service-worker.js",tracingEnabled:n.tracingEnabled}),void 0===n.preloadContent||i.isArray(n.preloadContent)||s.warn('Specifying a type other than Array for "preloadContent" has been deprecated. Support for deprecated types may be removed in a future release.'),r.serviceWorkerScope=a.getServiceWorkerScopeFromLocation(r.serviceWorkerLocation),n.phashTag&&(r.phashTag=n.phashTag),s.logLevel=r.logLevel;var d=a.getLongTermExpiry();r.data.tracking_id=o.getStoredValue("OL_Tracking_ID"),r.data.tracking_id||(r.data.tracking_id="@OL@"+a.generateUUID().replace(/-/g,"").substring(4),o.setStoredValue("OL_Tracking_ID",r.data.tracking_id,d)),o.getStoredValue("OL_Prev_Tracking_ID")&&(r.data.prev_tracking_id=o.getStoredValue("OL_Prev_Tracking_ID")),r.data.lit=o.getStoredValue("OL_LIB_INSTALL_TIME"),r.data.lit||(r.data.lit=""+(new Date).getTime(),o.setStoredValue("OL_LIB_INSTALL_TIME",r.data.lit,d)),r.data.acit=o.getStoredValue("OL_APP_CLEAN_INSTALL_TIME"),r.data.acit||(r.data.acit=""+(new Date).getTime(),o.setStoredValue("OL_APP_CLEAN_INSTALL_TIME",r.data.acit,d)),r.data.session_length=0,r.data.average_session_length=0;var p=o.platformSettings();return a.extend(r,p),"true"!==o.getStoredValue("OL_TraceEnabled")||!1!==r.tracingEnabled&&void 0!==r.tracingEnabled||(r.tracingEnabled=!0),!0===r.tracingEnabled?(u.enableTracing(r),u.trace(r,"tracer.enabled","info","Tracer enabled on page",location)):!1===r.tracingEnabled&&u.disableTracing(r),u.trace(r,"settings.init","info","Settings refreshed",r),r.trace=function(e,t,n,r){return u.trace(this,e,t,n,r)}.bind(r),r.safariWebsitePushId||s.debug("safariWebsitePushId is not defined. Web push will not be available in Safari."),r}};e.exports={refreshSettings:n.refreshSettings}},{"../platform":20,"../services/logging":24,"../services/tracing":32,"../utils":36,underscore:2}],34:[function(e,t,n){var r=new RegExp("(googleapis|/gcm/|/fcm/)","i"),c={isFirefox:function(e){return!r.test(e.endpoint)},isChrome:function(e){return r.test(e.endpoint)},getDeliveryDetails:function(e){if(!e)return{};if(c.isFirefox(e)){var t=e.getKey("p256dh");return{platform:"firefox",subscriptionUrl:e.endpoint,clientKey:btoa(String.fromCharCode.apply(null,new Uint8Array(t)))}}if(c.isChrome(e)){var n={platform:"chrome",subscriptionUrl:e.endpoint,p256dh:"",auth:""};if(e.getKey&&e.getKey("p256dh")){var r=e.getKey("p256dh"),i=e.getKey("auth");n.p256dh=btoa(String.fromCharCode.apply(null,new Uint8Array(r))),n.auth=btoa(String.fromCharCode.apply(null,new Uint8Array(i)))}return n}return{}},promisifyIDBRequest:function(o){return new Promise(function(e,t){function n(){e(o.result),i()}function r(){t(o.error),i()}function i(){o.removeEventListener("complete",n),o.removeEventListener("success",n),o.removeEventListener("error",r),o.removeEventListener("abort",r)}o.addEventListener("complete",n),o.addEventListener("success",n),o.addEventListener("error",r),o.addEventListener("abort",r)})},safeToJson:function(e){try{return JSON.stringify(e)}catch(e){return"<could-not-be-presented-as-json>"}},promisedParseJSON:function(t){try{return Promise.resolve(JSON.parse(t))}catch(e){return Promise.reject(new Error('Could not parse string "'+t+'": '+e.message))}},generateMessageId:function(){return"message-"+(new Date).getTime()+"-"+parseInt(1e4*Math.random(),10)},isIndexedDBSupported:function(){return self.indexedDB&&self.IDBObjectStore&&self.IDBObjectStore.prototype.add&&self.IDBObjectStore.prototype.clear&&self.IDBObjectStore.prototype.getAll}};function i(e,t,n){this.dbStoreName=e+"-store";var r=self.indexedDB;if(r){var i=r.open(e,t);this.ready=c.promisifyIDBRequest(i),i.onupgradeneeded=function(){i.result.createObjectStore(this.dbStoreName,n)}.bind(this)}}i.prototype.transaction=function(s,a,u){return this.ready.then(function(e){var t="readonly";a.apply?u=a:a&&(t=a);var n,r=e.transaction(s,t),i=u(r,e),o=c.promisifyIDBRequest(r);return i?(n=i[0]&&"result"in i[0]?Promise.all(i.map(c.promisifyIDBRequest)):c.promisifyIDBRequest(i),o.then(function(){return n})):o})},i.prototype.get=function(t){try{var n=this.dbStoreName;return this.transaction(n,function(e){return e.objectStore(n).get(t)})}catch(e){return Promise.reject(e)}},i.prototype.getAll=function(){try{var t=this.dbStoreName;return this.transaction(t,function(e){return e.objectStore(t).getAll()})}catch(e){return Promise.reject(e)}},i.prototype.add=function(t){try{var n=this.dbStoreName;return this.transaction(n,"readwrite",function(e){e.objectStore(n).add(t)})}catch(e){return Promise.reject(e)}},i.prototype.put=function(t,n){try{var r=this.dbStoreName;return this.transaction(r,"readwrite",function(e){e.objectStore(r).put(n,t)})}catch(e){return Promise.reject(e)}},i.prototype.delete=function(t){try{var n=this.dbStoreName;return this.transaction(n,"readwrite",function(e){e.objectStore(n).delete(t)})}catch(e){return Promise.reject(e)}},i.prototype.clear=function(){try{var t=this.dbStoreName;return this.transaction(t,"readwrite",function(e){e.objectStore(t).clear()})}catch(e){return Promise.reject(e)}},t.exports={getDeliveryDetails:c.getDeliveryDetails,safeToJson:c.safeToJson,promisedParseJSON:c.promisedParseJSON,generateMessageId:c.generateMessageId,IndexedDBWrapper:i,isIndexedDBSupported:c.isIndexedDBSupported,tracingIdStorageKey:"OL_WEB_DEVICE_ID",tracingEnabledKey:"ol_tracing_enabled",traceDbName:"ol-service-worker-trace-events"}},{}],35:[function(e,t,n){var r=e("../services/permission"),i={getAskForPermissionFacade:function(e,t){var n={placement:t};return function(){r.askForPermission(e,"notification",n,function(){})}}};t.exports={getAskForPermissionFacade:i.getAskForPermissionFacade}},{"../services/permission":26}],36:[function(i,e,t){var n=i("uuid"),r=i("yaku/lib/yaku.core");var s={_Promise:void 0!==window.Promise&&-1!==window.Promise.toString().indexOf("[native code]")?window.Promise:r,generateUUID:function(){return n.v4()},getLongTermExpiry:function(){return new Date((new Date).setFullYear((new Date).getFullYear()+50))},extend:function(e,t){var n=i("underscore");if(null===t||"object"!=typeof t)return t;for(var r in t)t.hasOwnProperty(r)&&("object"!=typeof t[r]||n.isArray(t[r])?e[r]=t[r]:(void 0===e[r]&&(e[r]={}),s.extend(e[r],t[r])));return e},getDeep:function(e,t){for(var n=(t||"").split("."),r=e;void 0!==r&&0!==n.length;){var i=n.shift();try{r=r[i]}catch(e){r=void 0;break}}return r},nodeCallbackForTwo:function(n,r){return function(){var e=Array.prototype.slice.call(arguments,1),t=arguments[0];t&&r&&r.apply(null,arguments),!t&&n&&n.apply(null,e)}},arrayRemove:function(e,t){if(void 0!==e){var n=s.arrayIndexOf(e,t);if(n<0)return e;var r=e.slice(n+1||e.length);return e.length=n,Array.prototype.push.apply(e,r),e}},arrayIndexOf:function(e,t){if(void 0===e)return-1;for(var n=-1,r=0;r<e.length;r++)if(e[r]===t){n=r;break}return n},forEachInObject:function(e,t){if(void 0!==e)for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])},capitalize:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},toISOString:function(e){function t(e){return e<10?"0"+e:e}return e.toISOString?e.toISOString():e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"."+(e.getUTCMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"},deepCopy:function(e){return JSON.parse(JSON.stringify(e))},updateUrlParameter:function(e,t,n){var r=e.indexOf("#"),i=-1===r?"":e.substr(r);e=-1===r?e:e.substr(0,r);var o=new RegExp("([?&])"+t+"=.*?(&|$)","i"),s=-1!==e.indexOf("?")?"&":"?";return n?e=e.match(o)?e.replace(o,"$1"+t+"="+n+"$2"):e+s+t+"="+n:("?"===(e=e.replace(new RegExp("([?&]?)"+t+"=[^&]*","i"),"")).slice(-1)&&(e=e.slice(0,-1)),-1===e.indexOf("?")&&(e=e.replace(/&/,"?"))),e+i},isFunction:function(e){return e&&"[object Function]"==={}.toString.call(e)},filter:function(e,t){if(e.filter)return e.filter(t);for(var n=e.length,r=[],i=0;i<n;i++){var o=e[i];t(o)&&r.push(o)}return r},isHTTPS:function(){try{return/^https/.test(window.location.protocol)}catch(e){return!1}},isLocalhost:function(){try{return"localhost"===window.location.hostname}catch(e){return!1}},getHostname:function(){try{return window.location.hostname}catch(e){return""}},isTopWindow:function(){try{return window.top===window.self}catch(e){return!0}},getPageUrl:function(){try{return window.location.href}catch(e){return"unknown"}},getValidTrackingId:function(e){var t=i("../services/logging");return"string"==typeof e?e:"number"==typeof e?(t.info("v1.10.0 WARNING: OL ID was supplied as number type. Please supply as string type."),e.toString()):void 0},getServiceWorkerScopeFromLocation:function(e,t){if(!e||"string"!=typeof e||!e.trim())return"/";var n=e.trim().replace(/\/$/,"");if(/^\//.test(n))return n.replace(/(.*\/).*/,"$1");var r=(t||window.location.pathname).replace(/(.*\/).*/,"$1");if(/^\.\./.test(n)){var i=n.split("../").length-1,o=r.split("/");return o.slice(0,o.length-i-1).join("/")+"/"}return r},executeWithPromise:function(o){return new s._Promise(function(t,e){var n=!1;function r(e){n||(n=!0,t(e))}var i=o(r);i&&i.then&&"function"==typeof i.then&&i.then(r,e)})},urlBase64ToUint8Array:function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new window.Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}};e.exports={generateUUID:s.generateUUID,extend:s.extend,getDeep:s.getDeep,nodeCallbackForTwo:s.nodeCallbackForTwo,arrayRemove:s.arrayRemove,arrayIndexOf:s.arrayIndexOf,forEachInObject:s.forEachInObject,capitalize:s.capitalize,toISOString:s.toISOString,deepCopy:s.deepCopy,updateUrlParameter:s.updateUrlParameter,isFunction:s.isFunction,filter:s.filter,isHTTPS:s.isHTTPS,isLocalhost:s.isLocalhost,isTopWindow:s.isTopWindow,getPageUrl:s.getPageUrl,getHostname:s.getHostname,getValidTrackingId:s.getValidTrackingId,getLongTermExpiry:s.getLongTermExpiry,getServiceWorkerScopeFromLocation:s.getServiceWorkerScopeFromLocation,Promise:s._Promise,executeWithPromise:s.executeWithPromise,urlBase64ToUint8Array:s.urlBase64ToUint8Array}},{"../services/logging":24,underscore:2,uuid:3,"yaku/lib/yaku.core":8}],37:[function(e,t,n){function r(e,t){t=t||{},this._obj=e,this._queue=[],this._dispatcherRunning=!1,this._delay=void 0!==t.delay?t.delay:1e3,this._maxBackoffRetries=t.maxBackoffRetries||5,this._maxRandomMs=t.maxRandomMs||100,this._shouldPutBackOnQueue=function(e){var t=e[0];return!(!t||0!==t.statusCode)},"function"==typeof t.putBackOnQueueHandler&&(this._shouldPutBackOnQueue=t.putBackOnQueueHandler),this._retry=0}r.prototype.add=function(e,t,n){this._queue.push({method:e,args:t,callback:n}),this._dispatch()},r.prototype._getCallback=function(r){var i=function(){var e=i.this._shouldPutBackOnQueue(arguments);e?i.this._queue.unshift(r):i.this._retry=0,r.callback&&r.callback.apply(void 0,arguments);var t=i.this._delay*Math.pow(2,i.this._retry)+i.this._maxRandomMs*Math.random(),n=e?t:0;e&&i.this._retry<i.this._maxBackoffRetries&&(i.this._retry+=1),setTimeout(function(){i.this._dispatch(!0)},n)};return i.this=this,i},r.prototype._dispatch=function(e){if(!this._dispatcherRunning||e){var t=this._queue.shift();if(t){this._dispatcherRunning=!0;var n=t.args.concat(this._getCallback(t));this._obj[t.method].apply(this._obj,n)}else this._dispatcherRunning=!1}},t.exports=r},{}]},{},[9]);